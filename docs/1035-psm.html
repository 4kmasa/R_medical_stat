<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>35 R语言倾向性评分：匹配 | R语言实战医学统计</title>
  <meta name="description" content="35 R语言倾向性评分：匹配 | R语言实战医学统计" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="35 R语言倾向性评分：匹配 | R语言实战医学统计" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="35 R语言倾向性评分：匹配 | R语言实战医学统计" />
  <meta name="github-repo" content="ayueme/ayueme.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="35 R语言倾向性评分：匹配 | R语言实战医学统计" />
  
  <meta name="twitter:description" content="35 R语言倾向性评分：匹配 | R语言实战医学统计" />
  

<meta name="author" content="阿越就是我" />


<meta name="date" content="2023-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="1034-finygray.html"/>
<link rel="next" href="1036-pssc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R语言实战医学统计</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本书缘起"><i class="fa fa-check"></i>本书缘起</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#作者简介"><i class="fa fa-check"></i>作者简介</a></li>
</ul></li>
<li class="part"><span><b>I 基础统计分析</b></span></li>
<li class="chapter" data-level="1" data-path="1001-ttest.html"><a href="1001-ttest.html"><i class="fa fa-check"></i><b>1</b> t检验</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1001-ttest.html"><a href="1001-ttest.html#单样本t检验"><i class="fa fa-check"></i><b>1.1</b> 单样本t检验</a></li>
<li class="chapter" data-level="1.2" data-path="1001-ttest.html"><a href="1001-ttest.html#配对样本t检验"><i class="fa fa-check"></i><b>1.2</b> 配对样本t检验</a></li>
<li class="chapter" data-level="1.3" data-path="1001-ttest.html"><a href="1001-ttest.html#两样本t检验"><i class="fa fa-check"></i><b>1.3</b> 两样本t检验</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="1002-anova.html"><a href="1002-anova.html"><i class="fa fa-check"></i><b>2</b> 多样本均数比较的方差分析</a>
<ul>
<li class="chapter" data-level="2.1" data-path="1002-anova.html"><a href="1002-anova.html#完全随机设计资料的方差分析"><i class="fa fa-check"></i><b>2.1</b> 完全随机设计资料的方差分析</a></li>
<li class="chapter" data-level="2.2" data-path="1002-anova.html"><a href="1002-anova.html#随机区组设计资料的方差分析"><i class="fa fa-check"></i><b>2.2</b> 随机区组设计资料的方差分析</a></li>
<li class="chapter" data-level="2.3" data-path="1002-anova.html"><a href="1002-anova.html#拉丁方设计方差分析"><i class="fa fa-check"></i><b>2.3</b> 拉丁方设计方差分析</a></li>
<li class="chapter" data-level="2.4" data-path="1002-anova.html"><a href="1002-anova.html#两阶段交叉设计资料方差分析"><i class="fa fa-check"></i><b>2.4</b> 两阶段交叉设计资料方差分析</a></li>
<li class="chapter" data-level="2.5" data-path="1002-anova.html"><a href="1002-anova.html#多个样本均数间的多重比较"><i class="fa fa-check"></i><b>2.5</b> 多个样本均数间的多重比较</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="1002-anova.html"><a href="1002-anova.html#lsd-t检验"><i class="fa fa-check"></i><b>2.5.1</b> LSD-t检验</a></li>
<li class="chapter" data-level="2.5.2" data-path="1002-anova.html"><a href="1002-anova.html#tukeyhsd"><i class="fa fa-check"></i><b>2.5.2</b> TukeyHSD</a></li>
<li class="chapter" data-level="2.5.3" data-path="1002-anova.html"><a href="1002-anova.html#dunnett-t检验"><i class="fa fa-check"></i><b>2.5.3</b> Dunnett-t检验</a></li>
<li class="chapter" data-level="2.5.4" data-path="1002-anova.html"><a href="1002-anova.html#snk-q检验"><i class="fa fa-check"></i><b>2.5.4</b> SNK-q检验</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="1002-anova.html"><a href="1002-anova.html#多样本方差比较的bartlett检验和levene检验"><i class="fa fa-check"></i><b>2.6</b> 多样本方差比较的Bartlett检验和Levene检验</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="1002-anova.html"><a href="1002-anova.html#多样本方差比较的bartlett检验"><i class="fa fa-check"></i><b>2.6.1</b> 多样本方差比较的Bartlett检验</a></li>
<li class="chapter" data-level="2.6.2" data-path="1002-anova.html"><a href="1002-anova.html#多样本方差比较的levene检验"><i class="fa fa-check"></i><b>2.6.2</b> 多样本方差比较的Levene检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="1003-dysanova.html"><a href="1003-dysanova.html"><i class="fa fa-check"></i><b>3</b> 多因素方差分析</a>
<ul>
<li class="chapter" data-level="3.1" data-path="1003-dysanova.html"><a href="1003-dysanova.html#x-2-两因素析因设计资料的方差分析"><i class="fa fa-check"></i><b>3.1</b> 2 x 2 两因素析因设计资料的方差分析</a></li>
<li class="chapter" data-level="3.2" data-path="1003-dysanova.html"><a href="1003-dysanova.html#i-x-j-两因素析因设计资料的方差分析"><i class="fa fa-check"></i><b>3.2</b> I x J 两因素析因设计资料的方差分析</a></li>
<li class="chapter" data-level="3.3" data-path="1003-dysanova.html"><a href="1003-dysanova.html#i-x-j-x-k-三因素析因设计资料的方差分析"><i class="fa fa-check"></i><b>3.3</b> I x J x K 三因素析因设计资料的方差分析</a></li>
<li class="chapter" data-level="3.4" data-path="1003-dysanova.html"><a href="1003-dysanova.html#正交设计资料的方差分析"><i class="fa fa-check"></i><b>3.4</b> 正交设计资料的方差分析</a></li>
<li class="chapter" data-level="3.5" data-path="1003-dysanova.html"><a href="1003-dysanova.html#嵌套设计资料的方差分析"><i class="fa fa-check"></i><b>3.5</b> 嵌套设计资料的方差分析</a></li>
<li class="chapter" data-level="3.6" data-path="1003-dysanova.html"><a href="1003-dysanova.html#裂区设计资料的方差分析"><i class="fa fa-check"></i><b>3.6</b> 裂区设计资料的方差分析</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="1004-repeatedmeaanova.html"><a href="1004-repeatedmeaanova.html"><i class="fa fa-check"></i><b>4</b> 重复测量方差分析</a>
<ul>
<li class="chapter" data-level="4.1" data-path="1004-repeatedmeaanova.html"><a href="1004-repeatedmeaanova.html#重复测量数据两因素两水平的方差分析"><i class="fa fa-check"></i><b>4.1</b> 重复测量数据两因素两水平的方差分析</a></li>
<li class="chapter" data-level="4.2" data-path="1004-repeatedmeaanova.html"><a href="1004-repeatedmeaanova.html#重复测量数据两因素多水平的分析"><i class="fa fa-check"></i><b>4.2</b> 重复测量数据两因素多水平的分析</a></li>
<li class="chapter" data-level="4.3" data-path="1004-repeatedmeaanova.html"><a href="1004-repeatedmeaanova.html#重复测量数据的多重比较"><i class="fa fa-check"></i><b>4.3</b> 重复测量数据的多重比较</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="1004-repeatedmeaanova.html"><a href="1004-repeatedmeaanova.html#组间差别多重比较"><i class="fa fa-check"></i><b>4.3.1</b> 组间差别多重比较</a></li>
<li class="chapter" data-level="4.3.2" data-path="1004-repeatedmeaanova.html"><a href="1004-repeatedmeaanova.html#时间趋势比较"><i class="fa fa-check"></i><b>4.3.2</b> 时间趋势比较</a></li>
<li class="chapter" data-level="4.3.3" data-path="1004-repeatedmeaanova.html"><a href="1004-repeatedmeaanova.html#时间点比较"><i class="fa fa-check"></i><b>4.3.3</b> 时间点比较</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="1005-ancova.html"><a href="1005-ancova.html"><i class="fa fa-check"></i><b>5</b> 协方差分析</a>
<ul>
<li class="chapter" data-level="5.1" data-path="1005-ancova.html"><a href="1005-ancova.html#完全随机设计资料的协方差分析"><i class="fa fa-check"></i><b>5.1</b> 完全随机设计资料的协方差分析</a></li>
<li class="chapter" data-level="5.2" data-path="1005-ancova.html"><a href="1005-ancova.html#使用rstatix进行优雅的协方差分析"><i class="fa fa-check"></i><b>5.2</b> 使用rstatix进行优雅的协方差分析</a></li>
<li class="chapter" data-level="5.3" data-path="1005-ancova.html"><a href="1005-ancova.html#随机区组设计资料的协方差分析"><i class="fa fa-check"></i><b>5.3</b> 随机区组设计资料的协方差分析</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="1006-chisq.html"><a href="1006-chisq.html"><i class="fa fa-check"></i><b>6</b> 卡方检验</a>
<ul>
<li class="chapter" data-level="6.1" data-path="1006-chisq.html"><a href="1006-chisq.html#不同类型卡方检验的选择"><i class="fa fa-check"></i><b>6.1</b> 不同类型卡方检验的选择</a></li>
<li class="chapter" data-level="6.2" data-path="1006-chisq.html"><a href="1006-chisq.html#四格表资料的卡方检验"><i class="fa fa-check"></i><b>6.2</b> 四格表资料的卡方检验</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="1006-chisq.html"><a href="1006-chisq.html#方法1"><i class="fa fa-check"></i><b>6.2.1</b> 方法1</a></li>
<li class="chapter" data-level="6.2.2" data-path="1006-chisq.html"><a href="1006-chisq.html#方法2"><i class="fa fa-check"></i><b>6.2.2</b> 方法2</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="1006-chisq.html"><a href="1006-chisq.html#配对四格表资料的卡方检验"><i class="fa fa-check"></i><b>6.3</b> 配对四格表资料的卡方检验</a></li>
<li class="chapter" data-level="6.4" data-path="1006-chisq.html"><a href="1006-chisq.html#四格表资料的-fisher-确切概率法"><i class="fa fa-check"></i><b>6.4</b> 四格表资料的 Fisher 确切概率法</a></li>
<li class="chapter" data-level="6.5" data-path="1006-chisq.html"><a href="1006-chisq.html#行-x-列表资料的卡方检验"><i class="fa fa-check"></i><b>6.5</b> 行 x 列表资料的卡方检验</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="1006-chisq.html"><a href="1006-chisq.html#多个样本率的比较"><i class="fa fa-check"></i><b>6.5.1</b> 多个样本率的比较</a></li>
<li class="chapter" data-level="6.5.2" data-path="1006-chisq.html"><a href="1006-chisq.html#样本构成比的比较"><i class="fa fa-check"></i><b>6.5.2</b> 样本构成比的比较</a></li>
<li class="chapter" data-level="6.5.3" data-path="1006-chisq.html"><a href="1006-chisq.html#双向无序分类资料的关联性检验"><i class="fa fa-check"></i><b>6.5.3</b> 双向无序分类资料的关联性检验</a></li>
<li class="chapter" data-level="6.5.4" data-path="1006-chisq.html"><a href="1006-chisq.html#双向有序分组资料的线性趋势检验"><i class="fa fa-check"></i><b>6.5.4</b> 双向有序分组资料的线性趋势检验</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="1006-chisq.html"><a href="1006-chisq.html#多个样本率间的多重比较"><i class="fa fa-check"></i><b>6.6</b> 多个样本率间的多重比较</a></li>
<li class="chapter" data-level="6.7" data-path="1006-chisq.html"><a href="1006-chisq.html#cochran-mantel-haenszel-卡方统计量检验"><i class="fa fa-check"></i><b>6.7</b> Cochran-Mantel-Haenszel 卡方统计量检验</a></li>
<li class="chapter" data-level="6.8" data-path="1006-chisq.html"><a href="1006-chisq.html#频数分布拟合优度卡方检验"><i class="fa fa-check"></i><b>6.8</b> 频数分布拟合优度卡方检验</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html"><i class="fa fa-check"></i><b>7</b> 秩和检验</a>
<ul>
<li class="chapter" data-level="7.1" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#配对样本比较的wilcoxon符号秩检验"><i class="fa fa-check"></i><b>7.1</b> 配对样本比较的Wilcoxon符号秩检验</a></li>
<li class="chapter" data-level="7.2" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#两独立样本比较的wilcoxon符号秩检验"><i class="fa fa-check"></i><b>7.2</b> 两独立样本比较的Wilcoxon符号秩检验</a></li>
<li class="chapter" data-level="7.3" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#完全随机设计多个样本比较的-kruskal-wallis-h-检验"><i class="fa fa-check"></i><b>7.3</b> 完全随机设计多个样本比较的 Kruskal-Wallis H 检验</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#多样本比较的kruskal-wallis-h检验"><i class="fa fa-check"></i><b>7.3.1</b> 多样本比较的kruskal-wallis H检验</a></li>
<li class="chapter" data-level="7.3.2" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#kruskal-wallis-h检验后的多重比较"><i class="fa fa-check"></i><b>7.3.2</b> kruskal-Wallis H检验后的多重比较</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#随记区组设计多个样本比较的-friedman-m-检验"><i class="fa fa-check"></i><b>7.4</b> 随记区组设计多个样本比较的 Friedman M 检验</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#多个相关样本比较的friedman-m检验"><i class="fa fa-check"></i><b>7.4.1</b> 多个相关样本比较的Friedman M检验</a></li>
<li class="chapter" data-level="7.4.2" data-path="1007-wilcoxn.html"><a href="1007-wilcoxn.html#多个相关样本两两比较的q检验"><i class="fa fa-check"></i><b>7.4.2</b> 多个相关样本两两比较的q检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="1008-mauchlytest.html"><a href="1008-mauchlytest.html"><i class="fa fa-check"></i><b>8</b> 球对称检验</a>
<ul>
<li class="chapter" data-level="8.1" data-path="1008-mauchlytest.html"><a href="1008-mauchlytest.html#球对称检验"><i class="fa fa-check"></i><b>8.1</b> 球对称检验</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="1008-mauchlytest.html"><a href="1008-mauchlytest.html#使用课本表12-3的数据"><i class="fa fa-check"></i><b>8.1.1</b> 使用课本<strong>表12-3</strong>的数据</a></li>
<li class="chapter" data-level="8.1.2" data-path="1008-mauchlytest.html"><a href="1008-mauchlytest.html#使用课本例12-3的数据"><i class="fa fa-check"></i><b>8.1.2</b> 使用课本<strong>例12-3</strong>的数据</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="1009-cochranarmitage.html"><a href="1009-cochranarmitage.html"><i class="fa fa-check"></i><b>9</b> R语言Cochran Armitage检验</a></li>
<li class="chapter" data-level="10" data-path="1010-anovaattention.html"><a href="1010-anovaattention.html"><i class="fa fa-check"></i><b>10</b> R语言方差分析注意事项</a>
<ul>
<li class="chapter" data-level="10.1" data-path="1010-anovaattention.html"><a href="1010-anovaattention.html#均衡设计和非均衡设计"><i class="fa fa-check"></i><b>10.1</b> 均衡设计和非均衡设计</a></li>
<li class="chapter" data-level="10.2" data-path="1010-anovaattention.html"><a href="1010-anovaattention.html#方差分析的3种类型"><i class="fa fa-check"></i><b>10.2</b> 方差分析的3种类型</a></li>
<li class="chapter" data-level="10.3" data-path="1010-anovaattention.html"><a href="1010-anovaattention.html#示例"><i class="fa fa-check"></i><b>10.3</b> 示例</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="1010-anovaattention.html"><a href="1010-anovaattention.html#one-way-anova"><i class="fa fa-check"></i><b>10.3.1</b> one-way anova</a></li>
<li class="chapter" data-level="10.3.2" data-path="1010-anovaattention.html"><a href="1010-anovaattention.html#two-way-anova"><i class="fa fa-check"></i><b>10.3.2</b> two-way anova</a></li>
<li class="chapter" data-level="10.3.3" data-path="1010-anovaattention.html"><a href="1010-anovaattention.html#协方差分析"><i class="fa fa-check"></i><b>10.3.3</b> 协方差分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="1011-samplesize.html"><a href="1011-samplesize.html"><i class="fa fa-check"></i><b>11</b> 样本量计算</a>
<ul>
<li class="chapter" data-level="11.1" data-path="1011-samplesize.html"><a href="1011-samplesize.html#t检验的样本量计算"><i class="fa fa-check"></i><b>11.1</b> t检验的样本量计算</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="1011-samplesize.html"><a href="1011-samplesize.html#单样本t检验样本均数和已知总体均数比较"><i class="fa fa-check"></i><b>11.1.1</b> 单样本t检验（样本均数和已知总体均数比较）</a></li>
<li class="chapter" data-level="11.1.2" data-path="1011-samplesize.html"><a href="1011-samplesize.html#两样本t检验两样本均数比较"><i class="fa fa-check"></i><b>11.1.2</b> 两样本t检验（两样本均数比较）</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="1011-samplesize.html"><a href="1011-samplesize.html#多样本均数比较"><i class="fa fa-check"></i><b>11.2</b> 多样本均数比较</a></li>
<li class="chapter" data-level="11.3" data-path="1011-samplesize.html"><a href="1011-samplesize.html#样本率和已知总体率的比较"><i class="fa fa-check"></i><b>11.3</b> 样本率和已知总体率的比较</a></li>
<li class="chapter" data-level="11.4" data-path="1011-samplesize.html"><a href="1011-samplesize.html#两独立样本率的比较"><i class="fa fa-check"></i><b>11.4</b> 两独立样本率的比较</a></li>
<li class="chapter" data-level="11.5" data-path="1011-samplesize.html"><a href="1011-samplesize.html#多样本率的比较"><i class="fa fa-check"></i><b>11.5</b> 多样本率的比较</a></li>
<li class="chapter" data-level="11.6" data-path="1011-samplesize.html"><a href="1011-samplesize.html#直线相关分析"><i class="fa fa-check"></i><b>11.6</b> 直线相关分析</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="1012-randomgroup.html"><a href="1012-randomgroup.html"><i class="fa fa-check"></i><b>12</b> 随机分组</a>
<ul>
<li class="chapter" data-level="12.1" data-path="1012-randomgroup.html"><a href="1012-randomgroup.html#简单随机"><i class="fa fa-check"></i><b>12.1</b> 简单随机</a></li>
<li class="chapter" data-level="12.2" data-path="1012-randomgroup.html"><a href="1012-randomgroup.html#区组随机"><i class="fa fa-check"></i><b>12.2</b> 区组随机</a></li>
<li class="chapter" data-level="12.3" data-path="1012-randomgroup.html"><a href="1012-randomgroup.html#分层随机"><i class="fa fa-check"></i><b>12.3</b> 分层随机</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="1013-rstastix.html"><a href="1013-rstastix.html"><i class="fa fa-check"></i><b>13</b> R语言tidy风格医学统计学</a>
<ul>
<li class="chapter" data-level="13.1" data-path="1013-rstastix.html"><a href="1013-rstastix.html#主要函数"><i class="fa fa-check"></i><b>13.1</b> 主要函数</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="1013-rstastix.html"><a href="1013-rstastix.html#描述性统计"><i class="fa fa-check"></i><b>13.1.1</b> 描述性统计</a></li>
<li class="chapter" data-level="13.1.2" data-path="1013-rstastix.html"><a href="1013-rstastix.html#比较均值"><i class="fa fa-check"></i><b>13.1.2</b> 比较均值</a></li>
<li class="chapter" data-level="13.1.3" data-path="1013-rstastix.html"><a href="1013-rstastix.html#增强r中的anova"><i class="fa fa-check"></i><b>13.1.3</b> 增强R中的ANOVA</a></li>
<li class="chapter" data-level="13.1.4" data-path="1013-rstastix.html"><a href="1013-rstastix.html#事后检验post-hoc"><i class="fa fa-check"></i><b>13.1.4</b> 事后检验（post-hoc）</a></li>
<li class="chapter" data-level="13.1.5" data-path="1013-rstastix.html"><a href="1013-rstastix.html#比较比例"><i class="fa fa-check"></i><b>13.1.5</b> 比较比例</a></li>
<li class="chapter" data-level="13.1.6" data-path="1013-rstastix.html"><a href="1013-rstastix.html#比较方差"><i class="fa fa-check"></i><b>13.1.6</b> 比较方差</a></li>
<li class="chapter" data-level="13.1.7" data-path="1013-rstastix.html"><a href="1013-rstastix.html#计算效应量"><i class="fa fa-check"></i><b>13.1.7</b> 计算效应量</a></li>
<li class="chapter" data-level="13.1.8" data-path="1013-rstastix.html"><a href="1013-rstastix.html#相关性分析"><i class="fa fa-check"></i><b>13.1.8</b> 相关性分析</a></li>
<li class="chapter" data-level="13.1.9" data-path="1013-rstastix.html"><a href="1013-rstastix.html#添加p值和显著性标记"><i class="fa fa-check"></i><b>13.1.9</b> 添加P值和显著性标记</a></li>
<li class="chapter" data-level="13.1.10" data-path="1013-rstastix.html"><a href="1013-rstastix.html#提取统计信息"><i class="fa fa-check"></i><b>13.1.10</b> 提取统计信息</a></li>
<li class="chapter" data-level="13.1.11" data-path="1013-rstastix.html"><a href="1013-rstastix.html#数据处理辅助函数"><i class="fa fa-check"></i><b>13.1.11</b> 数据处理辅助函数</a></li>
<li class="chapter" data-level="13.1.12" data-path="1013-rstastix.html"><a href="1013-rstastix.html#其他"><i class="fa fa-check"></i><b>13.1.12</b> 其他</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="1013-rstastix.html"><a href="1013-rstastix.html#安装和加载"><i class="fa fa-check"></i><b>13.2</b> 安装和加载</a></li>
<li class="chapter" data-level="13.3" data-path="1013-rstastix.html"><a href="1013-rstastix.html#描述性统计-1"><i class="fa fa-check"></i><b>13.3</b> 描述性统计</a></li>
<li class="chapter" data-level="13.4" data-path="1013-rstastix.html"><a href="1013-rstastix.html#t检验"><i class="fa fa-check"></i><b>13.4</b> t检验</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="1013-rstastix.html"><a href="1013-rstastix.html#单样本t检验-1"><i class="fa fa-check"></i><b>13.4.1</b> 单样本t检验</a></li>
<li class="chapter" data-level="13.4.2" data-path="1013-rstastix.html"><a href="1013-rstastix.html#配对t检验"><i class="fa fa-check"></i><b>13.4.2</b> 配对t检验</a></li>
<li class="chapter" data-level="13.4.3" data-path="1013-rstastix.html"><a href="1013-rstastix.html#两样本t检验-1"><i class="fa fa-check"></i><b>13.4.3</b> 两样本t检验</a></li>
<li class="chapter" data-level="13.4.4" data-path="1013-rstastix.html"><a href="1013-rstastix.html#分组后进行比较"><i class="fa fa-check"></i><b>13.4.4</b> 分组后进行比较</a></li>
<li class="chapter" data-level="13.4.5" data-path="1013-rstastix.html"><a href="1013-rstastix.html#多组间的两两比较"><i class="fa fa-check"></i><b>13.4.5</b> 多组间的两两比较</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="1013-rstastix.html"><a href="1013-rstastix.html#方差分析"><i class="fa fa-check"></i><b>13.5</b> 方差分析</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="1013-rstastix.html"><a href="1013-rstastix.html#完全随机设计方差分析"><i class="fa fa-check"></i><b>13.5.1</b> 完全随机设计方差分析</a></li>
<li class="chapter" data-level="13.5.2" data-path="1013-rstastix.html"><a href="1013-rstastix.html#随机区组设计资料的方差分析-1"><i class="fa fa-check"></i><b>13.5.2</b> 随机区组设计资料的方差分析</a></li>
<li class="chapter" data-level="13.5.3" data-path="1013-rstastix.html"><a href="1013-rstastix.html#拉丁方设计方差分析-1"><i class="fa fa-check"></i><b>13.5.3</b> 拉丁方设计方差分析</a></li>
<li class="chapter" data-level="13.5.4" data-path="1013-rstastix.html"><a href="1013-rstastix.html#两阶段交叉设计资料方差分析-1"><i class="fa fa-check"></i><b>13.5.4</b> 两阶段交叉设计资料方差分析</a></li>
<li class="chapter" data-level="13.5.5" data-path="1013-rstastix.html"><a href="1013-rstastix.html#析因设计资料的方差分析"><i class="fa fa-check"></i><b>13.5.5</b> 析因设计资料的方差分析</a></li>
<li class="chapter" data-level="13.5.6" data-path="1013-rstastix.html"><a href="1013-rstastix.html#正交设计资料的方差分析-1"><i class="fa fa-check"></i><b>13.5.6</b> 正交设计资料的方差分析</a></li>
<li class="chapter" data-level="13.5.7" data-path="1013-rstastix.html"><a href="1013-rstastix.html#重复测量数据两因素两水平的方差分析-1"><i class="fa fa-check"></i><b>13.5.7</b> 重复测量数据两因素两水平的方差分析</a></li>
<li class="chapter" data-level="13.5.8" data-path="1013-rstastix.html"><a href="1013-rstastix.html#重复测量数据两因素多水平的分析-1"><i class="fa fa-check"></i><b>13.5.8</b> 重复测量数据两因素多水平的分析</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="1013-rstastix.html"><a href="1013-rstastix.html#相关分析"><i class="fa fa-check"></i><b>13.6</b> 相关分析</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="1013-rstastix.html"><a href="1013-rstastix.html#两个变量"><i class="fa fa-check"></i><b>13.6.1</b> 两个变量</a></li>
<li class="chapter" data-level="13.6.2" data-path="1013-rstastix.html"><a href="1013-rstastix.html#一个变量和其他所有变量"><i class="fa fa-check"></i><b>13.6.2</b> 一个变量和其他所有变量</a></li>
<li class="chapter" data-level="13.6.3" data-path="1013-rstastix.html"><a href="1013-rstastix.html#所有变量间两两相关性"><i class="fa fa-check"></i><b>13.6.3</b> 所有变量间两两相关性</a></li>
<li class="chapter" data-level="13.6.4" data-path="1013-rstastix.html"><a href="1013-rstastix.html#相关矩阵"><i class="fa fa-check"></i><b>13.6.4</b> 相关矩阵</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="1014-rstatixmanyvariables.html"><a href="1014-rstatixmanyvariables.html"><i class="fa fa-check"></i><b>14</b> R语言多个变量同时进行t检验</a>
<ul>
<li class="chapter" data-level="14.1" data-path="1014-rstatixmanyvariables.html"><a href="1014-rstatixmanyvariables.html#简介"><i class="fa fa-check"></i><b>14.1</b> 简介</a></li>
<li class="chapter" data-level="14.2" data-path="1014-rstatixmanyvariables.html"><a href="1014-rstatixmanyvariables.html#实战"><i class="fa fa-check"></i><b>14.2</b> 实战</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="1015-twocorrelation.html"><a href="1015-twocorrelation.html"><i class="fa fa-check"></i><b>15</b> 双变量回归与相关</a>
<ul>
<li class="chapter" data-level="15.1" data-path="1015-twocorrelation.html"><a href="1015-twocorrelation.html#两样本相关"><i class="fa fa-check"></i><b>15.1</b> 两样本相关</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="1016-piancorrelation.html"><a href="1016-piancorrelation.html"><i class="fa fa-check"></i><b>16</b> 偏相关和典型相关</a>
<ul>
<li class="chapter" data-level="16.1" data-path="1016-piancorrelation.html"><a href="1016-piancorrelation.html#偏相关partial-correlation"><i class="fa fa-check"></i><b>16.1</b> 偏相关（partial correlation）</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="1016-piancorrelation.html"><a href="1016-piancorrelation.html#偏相关散点图"><i class="fa fa-check"></i><b>16.1.1</b> 偏相关散点图</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="1016-piancorrelation.html"><a href="1016-piancorrelation.html#典型相关canonical-correlation"><i class="fa fa-check"></i><b>16.2</b> 典型相关（Canonical Correlation）</a></li>
</ul></li>
<li class="part"><span><b>II 高级统计分析</b></span></li>
<li class="chapter" data-level="17" data-path="1017-multiregression.html"><a href="1017-multiregression.html"><i class="fa fa-check"></i><b>17</b> 多元线性回归</a>
<ul>
<li class="chapter" data-level="17.1" data-path="1017-multiregression.html"><a href="1017-multiregression.html#多元线性回归"><i class="fa fa-check"></i><b>17.1</b> 多元线性回归</a></li>
<li class="chapter" data-level="17.2" data-path="1017-multiregression.html"><a href="1017-multiregression.html#回归诊断"><i class="fa fa-check"></i><b>17.2</b> 回归诊断</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="1017-multiregression.html"><a href="1017-multiregression.html#可以通过看图来判断"><i class="fa fa-check"></i><b>17.2.1</b> 可以通过看图来判断</a></li>
<li class="chapter" data-level="17.2.2" data-path="1017-multiregression.html"><a href="1017-multiregression.html#也可以通过统计方法验证"><i class="fa fa-check"></i><b>17.2.2</b> 也可以通过统计方法验证</a></li>
<li class="chapter" data-level="17.2.3" data-path="1017-multiregression.html"><a href="1017-multiregression.html#多重共线性的检验"><i class="fa fa-check"></i><b>17.2.3</b> 多重共线性的检验</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="1017-multiregression.html"><a href="1017-multiregression.html#逐步选择法"><i class="fa fa-check"></i><b>17.3</b> 逐步选择法</a></li>
<li class="chapter" data-level="17.4" data-path="1017-multiregression.html"><a href="1017-multiregression.html#全局择优法"><i class="fa fa-check"></i><b>17.4</b> 全局择优法</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="1018-logistic.html"><a href="1018-logistic.html"><i class="fa fa-check"></i><b>18</b> Logistic回归</a>
<ul>
<li class="chapter" data-level="18.1" data-path="1018-logistic.html"><a href="1018-logistic.html#二项logistic回归"><i class="fa fa-check"></i><b>18.1</b> 二项logistic回归</a></li>
<li class="chapter" data-level="18.2" data-path="1018-logistic.html"><a href="1018-logistic.html#多项逻辑回归"><i class="fa fa-check"></i><b>18.2</b> 多项逻辑回归</a></li>
<li class="chapter" data-level="18.3" data-path="1018-logistic.html"><a href="1018-logistic.html#有序逻辑回归"><i class="fa fa-check"></i><b>18.3</b> 有序逻辑回归</a></li>
<li class="chapter" data-level="18.4" data-path="1018-logistic.html"><a href="1018-logistic.html#条件逻辑回归"><i class="fa fa-check"></i><b>18.4</b> 条件逻辑回归</a></li>
<li class="chapter" data-level="18.5" data-path="1018-logistic.html"><a href="1018-logistic.html#参考资料"><i class="fa fa-check"></i><b>18.5</b> 参考资料</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html"><i class="fa fa-check"></i><b>19</b> 分类变量进行回归分析时的编码方案</a>
<ul>
<li class="chapter" data-level="19.1" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#演示数据"><i class="fa fa-check"></i><b>19.1</b> 演示数据</a></li>
<li class="chapter" data-level="19.2" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#dummy-coding"><i class="fa fa-check"></i><b>19.2</b> Dummy Coding</a></li>
<li class="chapter" data-level="19.3" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#simple-coding"><i class="fa fa-check"></i><b>19.3</b> simple coding</a></li>
<li class="chapter" data-level="19.4" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#deviation-coding"><i class="fa fa-check"></i><b>19.4</b> Deviation coding</a></li>
<li class="chapter" data-level="19.5" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#orthogonal-polynomial-coding"><i class="fa fa-check"></i><b>19.5</b> Orthogonal Polynomial Coding</a></li>
<li class="chapter" data-level="19.6" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#helmert-coding"><i class="fa fa-check"></i><b>19.6</b> Helmert Coding</a></li>
<li class="chapter" data-level="19.7" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#reverse-helmert-coding"><i class="fa fa-check"></i><b>19.7</b> Reverse Helmert Coding</a></li>
<li class="chapter" data-level="19.8" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#forward-difference-coding"><i class="fa fa-check"></i><b>19.8</b> Forward Difference Coding</a></li>
<li class="chapter" data-level="19.9" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#backward-difference-coding"><i class="fa fa-check"></i><b>19.9</b> Backward Difference Coding</a></li>
<li class="chapter" data-level="19.10" data-path="1019-rcodecheme.html"><a href="1019-rcodecheme.html#参考资料-1"><i class="fa fa-check"></i><b>19.10</b> 参考资料</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="1020-discriminant.html"><a href="1020-discriminant.html"><i class="fa fa-check"></i><b>20</b> R语言判别分析</a>
<ul>
<li class="chapter" data-level="20.1" data-path="1020-discriminant.html"><a href="1020-discriminant.html#fisher判别分析"><i class="fa fa-check"></i><b>20.1</b> Fisher判别分析</a></li>
<li class="chapter" data-level="20.2" data-path="1020-discriminant.html"><a href="1020-discriminant.html#bayes判别分析"><i class="fa fa-check"></i><b>20.2</b> Bayes判别分析</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="1021-cluster.html"><a href="1021-cluster.html"><i class="fa fa-check"></i><b>21</b> R语言聚类分析</a>
<ul>
<li class="chapter" data-level="21.1" data-path="1021-cluster.html"><a href="1021-cluster.html#系统聚类层次聚类hierarchical-clustering"><i class="fa fa-check"></i><b>21.1</b> 系统聚类（层次聚类,Hierarchical clustering）</a></li>
<li class="chapter" data-level="21.2" data-path="1021-cluster.html"><a href="1021-cluster.html#聚类分析可视化"><i class="fa fa-check"></i><b>21.2</b> 聚类分析可视化</a></li>
<li class="chapter" data-level="21.3" data-path="1021-cluster.html"><a href="1021-cluster.html#快速聚类划分聚类partitioning-clustering"><i class="fa fa-check"></i><b>21.3</b> 快速聚类（划分聚类,partitioning clustering）</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="1021-cluster.html"><a href="1021-cluster.html#k-means聚类"><i class="fa fa-check"></i><b>21.3.1</b> K-means聚类</a></li>
<li class="chapter" data-level="21.3.2" data-path="1021-cluster.html"><a href="1021-cluster.html#围绕中心点的划分pam"><i class="fa fa-check"></i><b>21.3.2</b> 围绕中心点的划分PAM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="1022-pca.html"><a href="1022-pca.html"><i class="fa fa-check"></i><b>22</b> R语言主成分分析</a>
<ul>
<li class="chapter" data-level="22.1" data-path="1022-pca.html"><a href="1022-pca.html#加载数据"><i class="fa fa-check"></i><b>22.1</b> 加载数据</a></li>
<li class="chapter" data-level="22.2" data-path="1022-pca.html"><a href="1022-pca.html#相关性检验"><i class="fa fa-check"></i><b>22.2</b> 相关性检验</a></li>
<li class="chapter" data-level="22.3" data-path="1022-pca.html"><a href="1022-pca.html#kmo和bartlett球形检验"><i class="fa fa-check"></i><b>22.3</b> KMO和Bartlett球形检验</a></li>
<li class="chapter" data-level="22.4" data-path="1022-pca.html"><a href="1022-pca.html#r自带的pca"><i class="fa fa-check"></i><b>22.4</b> R自带的PCA</a></li>
<li class="chapter" data-level="22.5" data-path="1022-pca.html"><a href="1022-pca.html#结果可视化"><i class="fa fa-check"></i><b>22.5</b> 结果可视化</a></li>
<li class="chapter" data-level="22.6" data-path="1022-pca.html"><a href="1022-pca.html#主成分分析可视化超详细"><i class="fa fa-check"></i><b>22.6</b> 主成分分析可视化(超详细)</a>
<ul>
<li class="chapter" data-level="22.6.1" data-path="1022-pca.html"><a href="1022-pca.html#进行pca分析"><i class="fa fa-check"></i><b>22.6.1</b> 进行PCA分析</a></li>
<li class="chapter" data-level="22.6.2" data-path="1022-pca.html"><a href="1022-pca.html#特征值可视化"><i class="fa fa-check"></i><b>22.6.2</b> 特征值可视化</a></li>
<li class="chapter" data-level="22.6.3" data-path="1022-pca.html"><a href="1022-pca.html#提取变量结果"><i class="fa fa-check"></i><b>22.6.3</b> 提取变量结果</a></li>
<li class="chapter" data-level="22.6.4" data-path="1022-pca.html"><a href="1022-pca.html#变量结果可视化"><i class="fa fa-check"></i><b>22.6.4</b> 变量结果可视化</a></li>
<li class="chapter" data-level="22.6.5" data-path="1022-pca.html"><a href="1022-pca.html#dimension-description"><i class="fa fa-check"></i><b>22.6.5</b> Dimension description</a></li>
<li class="chapter" data-level="22.6.6" data-path="1022-pca.html"><a href="1022-pca.html#提取样本结果"><i class="fa fa-check"></i><b>22.6.6</b> 提取样本结果</a></li>
<li class="chapter" data-level="22.6.7" data-path="1022-pca.html"><a href="1022-pca.html#样本结果可视化"><i class="fa fa-check"></i><b>22.6.7</b> 样本结果可视化</a></li>
<li class="chapter" data-level="22.6.8" data-path="1022-pca.html"><a href="1022-pca.html#biplot"><i class="fa fa-check"></i><b>22.6.8</b> biplot</a></li>
</ul></li>
<li class="chapter" data-level="22.7" data-path="1022-pca.html"><a href="1022-pca.html#主成分分析可视化3d版"><i class="fa fa-check"></i><b>22.7</b> 主成分分析可视化3d版</a>
<ul>
<li class="chapter" data-level="22.7.1" data-path="1022-pca.html"><a href="1022-pca.html#提取数据"><i class="fa fa-check"></i><b>22.7.1</b> 提取数据</a></li>
<li class="chapter" data-level="22.7.2" data-path="1022-pca.html"><a href="1022-pca.html#d版"><i class="fa fa-check"></i><b>22.7.2</b> 3d版</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="1023-factoranalysis.html"><a href="1023-factoranalysis.html"><i class="fa fa-check"></i><b>23</b> R语言因子分析</a>
<ul>
<li class="chapter" data-level="23.1" data-path="1023-factoranalysis.html"><a href="1023-factoranalysis.html#演示数据-1"><i class="fa fa-check"></i><b>23.1</b> 演示数据</a></li>
<li class="chapter" data-level="23.2" data-path="1023-factoranalysis.html"><a href="1023-factoranalysis.html#判断需要提取的因子个数"><i class="fa fa-check"></i><b>23.2</b> 判断需要提取的因子个数</a></li>
<li class="chapter" data-level="23.3" data-path="1023-factoranalysis.html"><a href="1023-factoranalysis.html#进行因子分析"><i class="fa fa-check"></i><b>23.3</b> 进行因子分析</a></li>
<li class="chapter" data-level="23.4" data-path="1023-factoranalysis.html"><a href="1023-factoranalysis.html#因子旋转"><i class="fa fa-check"></i><b>23.4</b> 因子旋转</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="1024-rocbinomial.html"><a href="1024-rocbinomial.html"><i class="fa fa-check"></i><b>24</b> 二分类资料ROC曲线绘制</a>
<ul>
<li class="chapter" data-level="24.1" data-path="1024-rocbinomial.html"><a href="1024-rocbinomial.html#方法1-1"><i class="fa fa-check"></i><b>24.1</b> 方法1</a></li>
<li class="chapter" data-level="24.2" data-path="1024-rocbinomial.html"><a href="1024-rocbinomial.html#方法2-1"><i class="fa fa-check"></i><b>24.2</b> 方法2</a></li>
<li class="chapter" data-level="24.3" data-path="1024-rocbinomial.html"><a href="1024-rocbinomial.html#方法3"><i class="fa fa-check"></i><b>24.3</b> 方法3</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="1025-rocsurvival.html"><a href="1025-rocsurvival.html"><i class="fa fa-check"></i><b>25</b> 生存资料ROC曲线绘制</a>
<ul>
<li class="chapter" data-level="25.1" data-path="1025-rocsurvival.html"><a href="1025-rocsurvival.html#加载r包和数据"><i class="fa fa-check"></i><b>25.1</b> 加载R包和数据</a></li>
<li class="chapter" data-level="25.2" data-path="1025-rocsurvival.html"><a href="1025-rocsurvival.html#多个时间点roc"><i class="fa fa-check"></i><b>25.2</b> 多个时间点ROC</a></li>
<li class="chapter" data-level="25.3" data-path="1025-rocsurvival.html"><a href="1025-rocsurvival.html#多指标roc"><i class="fa fa-check"></i><b>25.3</b> 多指标ROC</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="1026-rocsurvsmooth.html"><a href="1026-rocsurvsmooth.html"><i class="fa fa-check"></i><b>26</b> 生存资料ROC曲线的最佳截点和平滑曲线</a>
<ul>
<li class="chapter" data-level="26.1" data-path="1026-rocsurvsmooth.html"><a href="1026-rocsurvsmooth.html#平滑曲线"><i class="fa fa-check"></i><b>26.1</b> 平滑曲线</a>
<ul>
<li class="chapter" data-level="26.1.1" data-path="1026-rocsurvsmooth.html"><a href="1026-rocsurvsmooth.html#加载r包和数据-1"><i class="fa fa-check"></i><b>26.1.1</b> 加载R包和数据</a></li>
<li class="chapter" data-level="26.1.2" data-path="1026-rocsurvsmooth.html"><a href="1026-rocsurvsmooth.html#多个时间点roc-1"><i class="fa fa-check"></i><b>26.1.2</b> 多个时间点ROC</a></li>
<li class="chapter" data-level="26.1.3" data-path="1026-rocsurvsmooth.html"><a href="1026-rocsurvsmooth.html#画平滑曲线"><i class="fa fa-check"></i><b>26.1.3</b> 画平滑曲线</a></li>
</ul></li>
<li class="chapter" data-level="26.2" data-path="1026-rocsurvsmooth.html"><a href="1026-rocsurvsmooth.html#找最佳截点"><i class="fa fa-check"></i><b>26.2</b> 找最佳截点</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="1027-roccompare.html"><a href="1027-roccompare.html"><i class="fa fa-check"></i><b>27</b> ROC曲线的显著性检验</a>
<ul>
<li class="chapter" data-level="27.1" data-path="1027-roccompare.html"><a href="1027-roccompare.html#二分类资料的roc比较"><i class="fa fa-check"></i><b>27.1</b> 二分类资料的ROC比较</a></li>
<li class="chapter" data-level="27.2" data-path="1027-roccompare.html"><a href="1027-roccompare.html#生存资料roc的比较"><i class="fa fa-check"></i><b>27.2</b> 生存资料ROC的比较</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="1028-rocdirection.html"><a href="1028-rocdirection.html"><i class="fa fa-check"></i><b>28</b> ROC阴性结果还是阳性结果</a>
<ul>
<li class="chapter" data-level="28.1" data-path="1028-rocdirection.html"><a href="1028-rocdirection.html#探索roc曲线"><i class="fa fa-check"></i><b>28.1</b> 探索ROC曲线</a></li>
<li class="chapter" data-level="28.2" data-path="1028-rocdirection.html"><a href="1028-rocdirection.html#反过来可以吗"><i class="fa fa-check"></i><b>28.2</b> 反过来可以吗？</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="1029-rocggplot.html"><a href="1029-rocggplot.html"><i class="fa fa-check"></i><b>29</b> ROC曲线ggplot2绘制</a>
<ul>
<li class="chapter" data-level="29.1" data-path="1029-rocggplot.html"><a href="1029-rocggplot.html#准备数据"><i class="fa fa-check"></i><b>29.1</b> 准备数据</a></li>
<li class="chapter" data-level="29.2" data-path="1029-rocggplot.html"><a href="1029-rocggplot.html#计算"><i class="fa fa-check"></i><b>29.2</b> 计算</a></li>
<li class="chapter" data-level="29.3" data-path="1029-rocggplot.html"><a href="1029-rocggplot.html#画图"><i class="fa fa-check"></i><b>29.3</b> 画图</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="1030-rocattention.html"><a href="1030-rocattention.html"><i class="fa fa-check"></i><b>30</b> R语言计算AUC(ROC)注意事项</a>
<ul>
<li class="chapter" data-level="30.1" data-path="1030-rocattention.html"><a href="1030-rocattention.html#准备数据-1"><i class="fa fa-check"></i><b>30.1</b> 准备数据</a></li>
<li class="chapter" data-level="30.2" data-path="1030-rocattention.html"><a href="1030-rocattention.html#rocr"><i class="fa fa-check"></i><b>30.2</b> ROCR</a></li>
<li class="chapter" data-level="30.3" data-path="1030-rocattention.html"><a href="1030-rocattention.html#proc"><i class="fa fa-check"></i><b>30.3</b> pROC</a></li>
<li class="chapter" data-level="30.4" data-path="1030-rocattention.html"><a href="1030-rocattention.html#yardstick"><i class="fa fa-check"></i><b>30.4</b> yardstick</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="1031-rocmany.html"><a href="1031-rocmany.html"><i class="fa fa-check"></i><b>31</b> 多指标联合诊断的ROC曲线</a>
<ul>
<li class="chapter" data-level="31.1" data-path="1031-rocmany.html"><a href="1031-rocmany.html#准备数据-2"><i class="fa fa-check"></i><b>31.1</b> 准备数据</a></li>
<li class="chapter" data-level="31.2" data-path="1031-rocmany.html"><a href="1031-rocmany.html#多指标联合诊断的roc"><i class="fa fa-check"></i><b>31.2</b> 多指标联合诊断的ROC</a></li>
<li class="chapter" data-level="31.3" data-path="1031-rocmany.html"><a href="1031-rocmany.html#测试集怎么办"><i class="fa fa-check"></i><b>31.3</b> 测试集怎么办？</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html"><i class="fa fa-check"></i><b>32</b> R语言生存分析</a>
<ul>
<li class="chapter" data-level="32.1" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html#生存过程的描述"><i class="fa fa-check"></i><b>32.1</b> 生存过程的描述</a></li>
<li class="chapter" data-level="32.2" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html#生存过程的比较"><i class="fa fa-check"></i><b>32.2</b> 生存过程的比较</a></li>
<li class="chapter" data-level="32.3" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html#cox回归"><i class="fa fa-check"></i><b>32.3</b> Cox回归</a></li>
<li class="chapter" data-level="32.4" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html#时间依存协变量的cox回归和时间依存系数cox回归"><i class="fa fa-check"></i><b>32.4</b> 时间依存协变量的Cox回归和时间依存系数Cox回归</a>
<ul>
<li class="chapter" data-level="32.4.1" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html#对时间分层"><i class="fa fa-check"></i><b>32.4.1</b> 对时间分层</a></li>
<li class="chapter" data-level="32.4.2" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html#连续性时依系数变换"><i class="fa fa-check"></i><b>32.4.2</b> 连续性时依系数变换</a></li>
</ul></li>
<li class="chapter" data-level="32.5" data-path="1032-survivalanalysis.html"><a href="1032-survivalanalysis.html#参考资料-2"><i class="fa fa-check"></i><b>32.5</b> 参考资料</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html"><i class="fa fa-check"></i><b>33</b> R语言超详细的生存曲线可视化</a>
<ul>
<li class="chapter" data-level="33.1" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#演示数据-2"><i class="fa fa-check"></i><b>33.1</b> 演示数据</a></li>
<li class="chapter" data-level="33.2" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#基本的生存曲线"><i class="fa fa-check"></i><b>33.2</b> 基本的生存曲线</a></li>
<li class="chapter" data-level="33.3" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#增加-risk-table"><i class="fa fa-check"></i><b>33.3</b> 增加 risk table</a></li>
<li class="chapter" data-level="33.4" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#增加删失时间表ncensor-plot"><i class="fa fa-check"></i><b>33.4</b> 增加删失时间表ncensor plot</a></li>
<li class="chapter" data-level="33.5" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#超级无敌精细化自定设置"><i class="fa fa-check"></i><b>33.5</b> 超级无敌精细化自定设置</a></li>
<li class="chapter" data-level="33.6" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#多个组的生存曲线"><i class="fa fa-check"></i><b>33.6</b> 多个组的生存曲线</a></li>
<li class="chapter" data-level="33.7" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#多个分类变量分面绘制"><i class="fa fa-check"></i><b>33.7</b> 多个分类变量分面绘制</a></li>
<li class="chapter" data-level="33.8" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#同时绘制多个生存函数"><i class="fa fa-check"></i><b>33.8</b> 同时绘制多个生存函数</a></li>
<li class="chapter" data-level="33.9" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#根据某一个变量分组绘制"><i class="fa fa-check"></i><b>33.9</b> 根据某一个变量分组绘制</a></li>
<li class="chapter" data-level="33.10" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#在原有生存曲线的基础上增加"><i class="fa fa-check"></i><b>33.10</b> 在原有生存曲线的基础上增加</a></li>
<li class="chapter" data-level="33.11" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#多个生存函数画在一起"><i class="fa fa-check"></i><b>33.11</b> 多个生存函数画在一起</a></li>
<li class="chapter" data-level="33.12" data-path="1033-survivalvisiualization.html"><a href="1033-survivalvisiualization.html#参考资料-3"><i class="fa fa-check"></i><b>33.12</b> 参考资料</a></li>
</ul></li>
<li class="part"><span><b>III 文献中常用的统计方法</b></span></li>
<li class="chapter" data-level="34" data-path="1034-finygray.html"><a href="1034-finygray.html"><i class="fa fa-check"></i><b>34</b> Fine-Gray检验、竞争风险模型列线图绘制</a>
<ul>
<li class="chapter" data-level="34.1" data-path="1034-finygray.html"><a href="1034-finygray.html#加载数据和r包"><i class="fa fa-check"></i><b>34.1</b> 加载数据和R包</a></li>
<li class="chapter" data-level="34.2" data-path="1034-finygray.html"><a href="1034-finygray.html#fine-gray检验单因素分析"><i class="fa fa-check"></i><b>34.2</b> Fine-Gray检验（单因素分析）</a>
<ul>
<li class="chapter" data-level="34.2.1" data-path="1034-finygray.html"><a href="1034-finygray.html#图形展示结果"><i class="fa fa-check"></i><b>34.2.1</b> 图形展示结果</a></li>
<li class="chapter" data-level="34.2.2" data-path="1034-finygray.html"><a href="1034-finygray.html#ggplot2"><i class="fa fa-check"></i><b>34.2.2</b> ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="34.3" data-path="1034-finygray.html"><a href="1034-finygray.html#竞争风险模型多因素分析"><i class="fa fa-check"></i><b>34.3</b> 竞争风险模型（多因素分析）</a></li>
<li class="chapter" data-level="34.4" data-path="1034-finygray.html"><a href="1034-finygray.html#列线图"><i class="fa fa-check"></i><b>34.4</b> 列线图</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="1035-psm.html"><a href="1035-psm.html"><i class="fa fa-check"></i><b>35</b> R语言倾向性评分：匹配</a>
<ul>
<li class="chapter" data-level="35.1" data-path="1035-psm.html"><a href="1035-psm.html#准备数据-3"><i class="fa fa-check"></i><b>35.1</b> 准备数据</a></li>
<li class="chapter" data-level="35.2" data-path="1035-psm.html"><a href="1035-psm.html#matchit包进行psm"><i class="fa fa-check"></i><b>35.2</b> matchIt包进行PSM</a>
<ul>
<li class="chapter" data-level="35.2.1" data-path="1035-psm.html"><a href="1035-psm.html#使用随机森林计算ps"><i class="fa fa-check"></i><b>35.2.1</b> 使用随机森林计算PS</a></li>
</ul></li>
<li class="chapter" data-level="35.3" data-path="1035-psm.html"><a href="1035-psm.html#主要匹配方法选择"><i class="fa fa-check"></i><b>35.3</b> 主要匹配方法选择</a></li>
<li class="chapter" data-level="35.4" data-path="1035-psm.html"><a href="1035-psm.html#匹配后数据的平衡性检验"><i class="fa fa-check"></i><b>35.4</b> 匹配后数据的平衡性检验</a>
<ul>
<li class="chapter" data-level="35.4.1" data-path="1035-psm.html"><a href="1035-psm.html#cobalt包"><i class="fa fa-check"></i><b>35.4.1</b> cobalt包</a></li>
<li class="chapter" data-level="35.4.2" data-path="1035-psm.html"><a href="1035-psm.html#统计检验衡量均衡性"><i class="fa fa-check"></i><b>35.4.2</b> 统计检验衡量均衡性</a></li>
</ul></li>
<li class="chapter" data-level="35.5" data-path="1035-psm.html"><a href="1035-psm.html#结果可视化-1"><i class="fa fa-check"></i><b>35.5</b> 结果可视化</a></li>
<li class="chapter" data-level="35.6" data-path="1035-psm.html"><a href="1035-psm.html#不平衡怎么办"><i class="fa fa-check"></i><b>35.6</b> 不平衡怎么办？</a></li>
<li class="chapter" data-level="35.7" data-path="1035-psm.html"><a href="1035-psm.html#其他问题"><i class="fa fa-check"></i><b>35.7</b> 其他问题</a></li>
<li class="chapter" data-level="35.8" data-path="1035-psm.html"><a href="1035-psm.html#参考资料-4"><i class="fa fa-check"></i><b>35.8</b> 参考资料</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="1036-pssc.html"><a href="1036-pssc.html"><i class="fa fa-check"></i><b>36</b> R语言倾向性评分：回归和分层</a>
<ul>
<li class="chapter" data-level="36.1" data-path="1036-pssc.html"><a href="1036-pssc.html#演示数据-3"><i class="fa fa-check"></i><b>36.1</b> 演示数据</a></li>
<li class="chapter" data-level="36.2" data-path="1036-pssc.html"><a href="1036-pssc.html#原始数据的概况"><i class="fa fa-check"></i><b>36.2</b> 原始数据的概况</a></li>
<li class="chapter" data-level="36.3" data-path="1036-pssc.html"><a href="1036-pssc.html#计算倾向性评分"><i class="fa fa-check"></i><b>36.3</b> 计算倾向性评分</a></li>
<li class="chapter" data-level="36.4" data-path="1036-pssc.html"><a href="1036-pssc.html#倾向性评分回归"><i class="fa fa-check"></i><b>36.4</b> 倾向性评分回归</a></li>
<li class="chapter" data-level="36.5" data-path="1036-pssc.html"><a href="1036-pssc.html#倾向性评分分层"><i class="fa fa-check"></i><b>36.5</b> 倾向性评分分层</a></li>
<li class="chapter" data-level="36.6" data-path="1036-pssc.html"><a href="1036-pssc.html#分层后的数据"><i class="fa fa-check"></i><b>36.6</b> 分层后的数据</a></li>
<li class="chapter" data-level="36.7" data-path="1036-pssc.html"><a href="1036-pssc.html#总结"><i class="fa fa-check"></i><b>36.7</b> 总结</a></li>
<li class="chapter" data-level="36.8" data-path="1036-pssc.html"><a href="1036-pssc.html#参考资料-5"><i class="fa fa-check"></i><b>36.8</b> 参考资料</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="1037-psw.html"><a href="1037-psw.html"><i class="fa fa-check"></i><b>37</b> R语言倾向性评分：加权</a>
<ul>
<li class="chapter" data-level="37.1" data-path="1037-psw.html"><a href="1037-psw.html#演示数据-4"><i class="fa fa-check"></i><b>37.1</b> 演示数据</a></li>
<li class="chapter" data-level="37.2" data-path="1037-psw.html"><a href="1037-psw.html#iptw"><i class="fa fa-check"></i><b>37.2</b> IPTW</a></li>
<li class="chapter" data-level="37.3" data-path="1037-psw.html"><a href="1037-psw.html#重叠加权"><i class="fa fa-check"></i><b>37.3</b> 重叠加权</a></li>
<li class="chapter" data-level="37.4" data-path="1037-psw.html"><a href="1037-psw.html#参考资料-6"><i class="fa fa-check"></i><b>37.4</b> 参考资料</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="1038-p4trend.html"><a href="1038-p4trend.html"><i class="fa fa-check"></i><b>38</b> p for trend/ p for interaction/ per 1 sd 的R语言实现</a>
<ul>
<li class="chapter" data-level="38.1" data-path="1038-p4trend.html"><a href="1038-p4trend.html#p-for-trend"><i class="fa fa-check"></i><b>38.1</b> P for trend</a></li>
<li class="chapter" data-level="38.2" data-path="1038-p4trend.html"><a href="1038-p4trend.html#p-for-interaction"><i class="fa fa-check"></i><b>38.2</b> p for interaction</a>
<ul>
<li class="chapter" data-level="38.2.1" data-path="1038-p4trend.html"><a href="1038-p4trend.html#方法1-2"><i class="fa fa-check"></i><b>38.2.1</b> 方法1</a></li>
<li class="chapter" data-level="38.2.2" data-path="1038-p4trend.html"><a href="1038-p4trend.html#方法2-2"><i class="fa fa-check"></i><b>38.2.2</b> 方法2</a></li>
</ul></li>
<li class="chapter" data-level="38.3" data-path="1038-p4trend.html"><a href="1038-p4trend.html#per-1-sd"><i class="fa fa-check"></i><b>38.3</b> per 1 sd</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="1039-nonlinearfit.html"><a href="1039-nonlinearfit.html"><i class="fa fa-check"></i><b>39</b> R语言多项式拟合及样条回归</a>
<ul>
<li class="chapter" data-level="39.1" data-path="1039-nonlinearfit.html"><a href="1039-nonlinearfit.html#多项式拟合"><i class="fa fa-check"></i><b>39.1</b> 多项式拟合</a></li>
<li class="chapter" data-level="39.2" data-path="1039-nonlinearfit.html"><a href="1039-nonlinearfit.html#样条回归"><i class="fa fa-check"></i><b>39.2</b> 样条回归</a>
<ul>
<li class="chapter" data-level="39.2.1" data-path="1039-nonlinearfit.html"><a href="1039-nonlinearfit.html#线性的立方样条"><i class="fa fa-check"></i><b>39.2.1</b> 线性的立方样条</a></li>
<li class="chapter" data-level="39.2.2" data-path="1039-nonlinearfit.html"><a href="1039-nonlinearfit.html#逻辑回归的立方样条"><i class="fa fa-check"></i><b>39.2.2</b> 逻辑回归的立方样条</a></li>
<li class="chapter" data-level="39.2.3" data-path="1039-nonlinearfit.html"><a href="1039-nonlinearfit.html#cox回归的立方样条"><i class="fa fa-check"></i><b>39.2.3</b> cox回归的立方样条</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV 附录</b></span></li>
<li class="chapter" data-level="40" data-path="1040-appendix.html"><a href="1040-appendix.html"><i class="fa fa-check"></i><b>40</b> R语言和R包安装</a>
<ul>
<li class="chapter" data-level="40.1" data-path="1040-appendix.html"><a href="1040-appendix.html#r语言rtoolsrstudio的安装"><i class="fa fa-check"></i><b>40.1</b> R语言、Rtools、Rstudio的安装</a></li>
<li class="chapter" data-level="40.2" data-path="1040-appendix.html"><a href="1040-appendix.html#r包安装"><i class="fa fa-check"></i><b>40.2</b> R包安装</a></li>
<li class="chapter" data-level="40.3" data-path="1040-appendix.html"><a href="1040-appendix.html#pass软件链接"><i class="fa fa-check"></i><b>40.3</b> PASS软件链接</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由bookdown强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R语言实战医学统计</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ysdkfjhsjk" class="section level1 hasAnchor" number="35">
<h1><span class="header-section-number">35</span> R语言倾向性评分：匹配<a href="1035-psm.html#ysdkfjhsjk" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>倾向性评分（Propensity Score, PS）是一种控制混杂因素的统计学方法，通过倾向性评分的方法，可以把基线控制在可比的水平，这样就可以比较处理因素带来的差异了。</p>
<p>比如，现在要比较A,B两种方法治疗肥胖的效果，随机分两组，分别使用A,B两种方法半年，看哪个方法效果好。一般收集到的病人性别、年龄、身高、体重、家族史、生活习惯、收入水平、生活地区等都是不一样的，这些混杂因素不控制，你很难说清楚到底是两种方法的效果还是混杂因素导致的。</p>
<p>利用倾向性评分就可以控制这些混杂，但是控制混杂因素的方法非常多，不要拘泥于此。对于类似上面这种情况，你还可以用协方差分析、多因素分析（统计学中的3大回归！线性回归、逻辑回归、Cox回归）、分层分析等，也可以起到控制混杂因素的效果，这些在之前的推文中全都有涉及，大家可以自行查看。</p>
<p>倾向性评分最大的优势是将多个混杂因素的影响用一个综合的值来表示，即<strong>倾向性评分值（Propensity Score, PS）</strong>，从而降低协变量的维度，因此该方法尤其适用于协变量较多的情况。</p>
<p>倾向性评分的一般步骤为：
1. 估计 PS 值；
2. 利用 PS 值均衡协变量分布；
3. 均衡性检验及模型评价；
4. 处理效应估计。</p>
<p>其中，PS 值的估计是<strong>以处理因素作为因变量，其他混杂因素作为自变量</strong>，通过建立一个模型（可以是传统的回归模型，也可以是机器学习方法）来估计每个研究对象接受处理因素的可能性。</p>
<p>目前用于估计 PS 值的方法有 logistic 回归，Probit 回归、神经网络、支持向量机、分类与回归数、Boosting 算法、SuperLearner 等。其中 logistic 回归是目前最常用的方法。</p>
<p>到底用什么方法，并没有标准，有些人喜欢复杂的机器学习方法，有的则喜欢传统的逻辑回归，并没有优劣之分，选择合适的就好。有的人觉得机器学习方法不好解释，比如神经网络，但是也有人认为计算PS只是一个小小的步骤，更多的精力应该放在计算出来的PS是否能完美的平衡数据上，PS的计算方法不好解释就不解释了，反正不是主要问题。</p>
<p>倾向性评分只是一个分数（P值），自己并没有均衡协变量（混杂因素）的能力，利用 PS 值均衡组间协变量分布的方法有匹配（matching）、分层（stratification）、协变量调整（covariate adjustment）和加权（weighting）等。4种方法均有各自的特点和局限，参考下图：</p>
<p><img src="figs/Snipaste_2023-04-05_16-57-54.png" width="90%" /></p>
<p>其中协变量调整又可以称为倾向性评分回归、倾向性评分矫正等。</p>
<p>用于倾向性评分的数据要进行一些预处理，比如<strong>缺失值处理</strong>，这在倾向性评分中是很重要的一部分内容！但是这里并没有过多演示这部分内容，因为缺失值处理是通用技能！处理缺失值的方法很多，也是没有统一的标准，选择合适的即可。比如直接删除，用常数值代替，用均值/中位数等代替，算法插补（KNN、随机森林等），没有统一的标准。缺失值处理的一些方法，也可以参考这篇推文：<a href="https://mp.weixin.qq.com/s/L7a1CTqkndYcpmszNReucg">我常用的缺失值插补方法</a></p>
<div id="准备数据-3" class="section level2 hasAnchor" number="35.1">
<h2><span class="header-section-number">35.1</span> 准备数据<a href="1035-psm.html#准备数据-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>下面的数据及演示的方法主要参考了这篇文章：10.21037/atm-20-3998。大家感兴趣的可以去阅读原文。</p>
<p>我们虚构一个数据，用于演示研究吸烟对心血管疾病的影响，性别和年龄作为混杂因素。</p>
<ul>
<li>CVD：结果变量，1是有心血管疾病，0是没有</li>
<li>x.Age：年龄</li>
<li>x.Gender：0是女，1是男</li>
<li>Smoke：1吸烟，0不吸烟，是我们的处理因素</li>
</ul>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="1035-psm.html#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020</span>)</span>
<span id="cb561-2"><a href="1035-psm.html#cb561-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-3"><a href="1035-psm.html#cb561-3" aria-hidden="true" tabindex="-1"></a>x.Gender <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">400</span>,<span class="dv">600</span>)) <span class="co"># 400女 600男</span></span>
<span id="cb561-4"><a href="1035-psm.html#cb561-4" aria-hidden="true" tabindex="-1"></a>x.Age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">mean=</span><span class="dv">45</span>, <span class="at">sd=</span><span class="dv">15</span>)))</span>
<span id="cb561-5"><a href="1035-psm.html#cb561-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-6"><a href="1035-psm.html#cb561-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 对于这个数据来说，实际PS（tps）是可以计算出来的，如果这里不理解，也问题不大！</span></span>
<span id="cb561-7"><a href="1035-psm.html#cb561-7" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> (x.Age <span class="sc">-</span> <span class="dv">45</span>) <span class="sc">/</span> <span class="dv">15</span> <span class="sc">-</span> (x.Age<span class="dv">-45</span>) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">100</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x.Gender</span>
<span id="cb561-8"><a href="1035-psm.html#cb561-8" aria-hidden="true" tabindex="-1"></a>tps <span class="ot">&lt;-</span> <span class="fu">exp</span>(z) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(z)) </span>
<span id="cb561-9"><a href="1035-psm.html#cb561-9" aria-hidden="true" tabindex="-1"></a>Smoke <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">runif</span>(<span class="dv">1000</span>) <span class="sc">&lt;</span> tps)</span>
<span id="cb561-10"><a href="1035-psm.html#cb561-10" aria-hidden="true" tabindex="-1"></a>z.y <span class="ot">&lt;-</span> x.Gender <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>x.Age <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>Smoke <span class="sc">-</span> <span class="dv">20</span></span>
<span id="cb561-11"><a href="1035-psm.html#cb561-11" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(z.y) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(z.y))</span>
<span id="cb561-12"><a href="1035-psm.html#cb561-12" aria-hidden="true" tabindex="-1"></a>CVD <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">runif</span>(<span class="dv">1000</span>) <span class="sc">&lt;</span> y)</span>
<span id="cb561-13"><a href="1035-psm.html#cb561-13" aria-hidden="true" tabindex="-1"></a>x.Age.mask <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, <span class="fl">0.2</span>) <span class="co"># 随机产生几个缺失值</span></span>
<span id="cb561-14"><a href="1035-psm.html#cb561-14" aria-hidden="true" tabindex="-1"></a>x.Age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(x.Age.mask<span class="sc">==</span><span class="dv">1</span>, <span class="cn">NA</span>, x.Age)</span>
<span id="cb561-15"><a href="1035-psm.html#cb561-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-16"><a href="1035-psm.html#cb561-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 原始数据长这样：</span></span>
<span id="cb561-17"><a href="1035-psm.html#cb561-17" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x.Age, x.Gender, Smoke, CVD)</span>
<span id="cb561-18"><a href="1035-psm.html#cb561-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span>
<span id="cb561-19"><a href="1035-psm.html#cb561-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   x.Age x.Gender Smoke CVD</span></span>
<span id="cb561-20"><a href="1035-psm.html#cb561-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 1    51        0     1   0</span></span>
<span id="cb561-21"><a href="1035-psm.html#cb561-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 2    50        0     0   0</span></span>
<span id="cb561-22"><a href="1035-psm.html#cb561-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 3    29        0     0   0</span></span>
<span id="cb561-23"><a href="1035-psm.html#cb561-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 4    28        0     0   0</span></span>
<span id="cb561-24"><a href="1035-psm.html#cb561-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 5     3        0     0   0</span></span>
<span id="cb561-25"><a href="1035-psm.html#cb561-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 6    56        0     1   1</span></span></code></pre></div>
<p>首先可以看一下原始数据的基线资料表，用的是<code>tableone</code>这个包，之前也做过介绍，做基线资料表的R包还有非常多，比如：</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s/V1K2ysKU5PtPW4H-xrYyZg">使用compareGroups包1行代码生成基线资料表</a></li>
<li><a href="https://mp.weixin.qq.com/s/NUWH-I5a_eBepQyAaz0ZUw">使用R语言快速绘制三线表</a></li>
<li><a href="https://mp.weixin.qq.com/s/GJydbFVZbB4zMp8rYnk5Hw">tableone？table1？傻傻分不清楚</a></li>
<li><a href="https://mp.weixin.qq.com/s/N9MpBq9Rb6DlqQD0Eza7UQ">超强的gtSummary ≈ gt + comparegroups ??</a></li>
</ul>
<p>为什么用<code>tableone</code>呢？因为它能计算SMD（后面会介绍这个SMD的作用），而且其他教程都是用的它…</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="1035-psm.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tableone)</span>
<span id="cb562-2"><a href="1035-psm.html#cb562-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-3"><a href="1035-psm.html#cb562-3" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&#39;x.Age&#39;</span>, <span class="st">&#39;x.Gender&#39;</span>, <span class="st">&#39;CVD&#39;</span>),</span>
<span id="cb562-4"><a href="1035-psm.html#cb562-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> data,</span>
<span id="cb562-5"><a href="1035-psm.html#cb562-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">factorVars =</span> <span class="fu">c</span>(<span class="st">&#39;x.Gender&#39;</span>, <span class="st">&#39;CVD&#39;</span>),</span>
<span id="cb562-6"><a href="1035-psm.html#cb562-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">strata =</span> <span class="st">&#39;Smoke&#39;</span>,</span>
<span id="cb562-7"><a href="1035-psm.html#cb562-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">smd=</span><span class="cn">TRUE</span>)</span>
<span id="cb562-8"><a href="1035-psm.html#cb562-8" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">print</span>(table2,<span class="at">smd=</span><span class="cn">TRUE</span>,</span>
<span id="cb562-9"><a href="1035-psm.html#cb562-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">showAllLevels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb562-10"><a href="1035-psm.html#cb562-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">noSpaces =</span> <span class="cn">TRUE</span>,</span>
<span id="cb562-11"><a href="1035-psm.html#cb562-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">printToggle =</span> <span class="cn">FALSE</span>)</span>
<span id="cb562-12"><a href="1035-psm.html#cb562-12" aria-hidden="true" tabindex="-1"></a>table2</span>
<span id="cb562-13"><a href="1035-psm.html#cb562-13" aria-hidden="true" tabindex="-1"></a><span class="do">##                    Stratified by Smoke</span></span>
<span id="cb562-14"><a href="1035-psm.html#cb562-14" aria-hidden="true" tabindex="-1"></a><span class="do">##                     level 0               1              p        test SMD    </span></span>
<span id="cb562-15"><a href="1035-psm.html#cb562-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   n                 &quot;&quot;    &quot;549&quot;           &quot;451&quot;          &quot;&quot;       &quot;&quot;   &quot;&quot;     </span></span>
<span id="cb562-16"><a href="1035-psm.html#cb562-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   x.Age (mean (SD)) &quot;&quot;    &quot;42.76 (19.69)&quot; &quot;47.04 (8.14)&quot; &quot;&lt;0.001&quot; &quot;&quot;   &quot;0.284&quot;</span></span>
<span id="cb562-17"><a href="1035-psm.html#cb562-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   x.Gender (%)      &quot;0&quot;   &quot;299 (54.5)&quot;    &quot;101 (22.4)&quot;   &quot;&lt;0.001&quot; &quot;&quot;   &quot;0.698&quot;</span></span>
<span id="cb562-18"><a href="1035-psm.html#cb562-18" aria-hidden="true" tabindex="-1"></a><span class="do">##                     &quot;1&quot;   &quot;250 (45.5)&quot;    &quot;350 (77.6)&quot;   &quot;&quot;       &quot;&quot;   &quot;&quot;     </span></span>
<span id="cb562-19"><a href="1035-psm.html#cb562-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   CVD (%)           &quot;0&quot;   &quot;452 (82.3)&quot;    &quot;230 (51.0)&quot;   &quot;&lt;0.001&quot; &quot;&quot;   &quot;0.705&quot;</span></span>
<span id="cb562-20"><a href="1035-psm.html#cb562-20" aria-hidden="true" tabindex="-1"></a><span class="do">##                     &quot;1&quot;   &quot;97 (17.7)&quot;     &quot;221 (49.0)&quot;   &quot;&quot;       &quot;&quot;   &quot;&quot;</span></span>
<span id="cb562-21"><a href="1035-psm.html#cb562-21" aria-hidden="true" tabindex="-1"></a><span class="co">#write.csv(table2, file = &quot;Table2_before_matching.csv&quot;)</span></span></code></pre></div>
<p>结果中可以看出<code>x.Age</code>和<code>x.Gender</code>两个变量在两组间是有差异的，其中<code>SMD(standardized mean differences)</code>可以用来衡量协变量在不同组间的差异；除此之外，这两个变量的P值在不同性别间也是小于0.001的，说明不同性别间这两个变量是有明显差别的。</p>
<p>如果此时直接探讨是否吸烟对<code>CVD</code>的影响，很有可能会得到错误的答案，经典的辛普森悖论就是由于混杂因素的存在才导致出现神奇的结果（比如有种药对男人有效，对女人也有效，但是对全人类就没效了！）。</p>
<p>所以要想办法解决<code>x.Age</code>和<code>x.Gender</code>两个变量在两组间的差异，达到基线可比的目的。今天要介绍的方法就是倾向性评分匹配。</p>
</div>
<div id="matchit包进行psm" class="section level2 hasAnchor" number="35.2">
<h2><span class="header-section-number">35.2</span> matchIt包进行PSM<a href="1035-psm.html#matchit包进行psm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>matchIt</code>包支持非常多计算PS的方法，比如自带的logistic回归、广义可加模型、分类和回归树、神经网络，除了自带的方法，也支持其他方法计算的PS。这些方法通过<code>distance</code>参数指定：</p>
<ul>
<li><code>distance</code>:指定PS的计算方法，默认是logit，即logistic回归，GAMlogit（广义可加模型），rpart（决策树）,nnet(神经网络)，除此之外，也可以是使用其他包或方法计算的PS值！</li>
<li><code>distance.options</code>:当你选择好了方法之后，不同的方法会有不同的额外选项。</li>
</ul>
<p>下面演示使用logistic回归的方法计算PS，这里我们的处理因素是二分类变量(是否吸烟)，可以通过逻辑回归计算这些协变量（也就是混杂因素）的P值，这个P值就是倾向性评分。<strong>倾向性评分就是P值！</strong>（有网友指出这样说不对，应该是参数pi表示事件的概率）</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="1035-psm.html#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb563-2"><a href="1035-psm.html#cb563-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-3"><a href="1035-psm.html#cb563-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 这里为了方便演示直接删掉了缺失值</span></span>
<span id="cb563-4"><a href="1035-psm.html#cb563-4" aria-hidden="true" tabindex="-1"></a>data.complete <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(data)</span>
<span id="cb563-5"><a href="1035-psm.html#cb563-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-6"><a href="1035-psm.html#cb563-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 因变量是处理因素，自变量是需要平衡的协变量</span></span>
<span id="cb563-7"><a href="1035-psm.html#cb563-7" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb563-8"><a href="1035-psm.html#cb563-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> data.complete,</span>
<span id="cb563-9"><a href="1035-psm.html#cb563-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span> <span class="co"># 选择logistic回归</span></span>
<span id="cb563-10"><a href="1035-psm.html#cb563-10" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb563-11"><a href="1035-psm.html#cb563-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-12"><a href="1035-psm.html#cb563-12" aria-hidden="true" tabindex="-1"></a>m.out</span>
<span id="cb563-13"><a href="1035-psm.html#cb563-13" aria-hidden="true" tabindex="-1"></a><span class="do">## A matchit object</span></span>
<span id="cb563-14"><a href="1035-psm.html#cb563-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  - method: 1:1 nearest neighbor matching without replacement</span></span>
<span id="cb563-15"><a href="1035-psm.html#cb563-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  - distance: Propensity score</span></span>
<span id="cb563-16"><a href="1035-psm.html#cb563-16" aria-hidden="true" tabindex="-1"></a><span class="do">##              - estimated with logistic regression</span></span>
<span id="cb563-17"><a href="1035-psm.html#cb563-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  - number of obs.: 831 (original), 738 (matched)</span></span>
<span id="cb563-18"><a href="1035-psm.html#cb563-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  - target estimand: ATT</span></span>
<span id="cb563-19"><a href="1035-psm.html#cb563-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  - covariates: x.Age, x.Gender</span></span></code></pre></div>
<p>上面是一个简单的结果，告诉你匹配方法是1:1无放回最近邻匹配，计算方法是logistic回归，匹配了738例等信息。</p>
<p>可通过以下方法获得算法估计的PS值：</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="1035-psm.html#cb564-1" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> m.out<span class="sc">$</span>distance</span>
<span id="cb564-2"><a href="1035-psm.html#cb564-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(eps)</span>
<span id="cb564-3"><a href="1035-psm.html#cb564-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 831</span></span>
<span id="cb564-4"><a href="1035-psm.html#cb564-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eps)</span>
<span id="cb564-5"><a href="1035-psm.html#cb564-5" aria-hidden="true" tabindex="-1"></a><span class="do">##         1         2         3         4         5         6 </span></span>
<span id="cb564-6"><a href="1035-psm.html#cb564-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.2583040 0.2545807 0.1847661 0.1818430 0.1200378 0.2774451</span></span></code></pre></div>
<p>一开始我们已经计算出了实际PS值（tps），所以我们可以画一个tps和估计ps的散点图，以tps为横坐标，以eps为纵坐标：</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="1035-psm.html#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb565-2"><a href="1035-psm.html#cb565-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-3"><a href="1035-psm.html#cb565-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 去掉缺失值</span></span>
<span id="cb565-4"><a href="1035-psm.html#cb565-4" aria-hidden="true" tabindex="-1"></a>tps.comp <span class="ot">&lt;-</span> tps[<span class="fu">complete.cases</span>(data)]</span>
<span id="cb565-5"><a href="1035-psm.html#cb565-5" aria-hidden="true" tabindex="-1"></a>Smoke.comp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Smoke[<span class="fu">complete.cases</span>(data)])</span>
<span id="cb565-6"><a href="1035-psm.html#cb565-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">True=</span>tps.comp, <span class="at">Estimated=</span>eps, <span class="at">Smoke=</span>Smoke.comp)</span>
<span id="cb565-7"><a href="1035-psm.html#cb565-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-8"><a href="1035-psm.html#cb565-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>True, <span class="at">y=</span>Estimated, <span class="at">colour=</span>Smoke)) <span class="sc">+</span></span>
<span id="cb565-9"><a href="1035-psm.html#cb565-9" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb565-10"><a href="1035-psm.html#cb565-10" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb565-11"><a href="1035-psm.html#cb565-11" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_limits</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="1035-psm_files/figure-html/unnamed-chunk-6-1.png" width="90%" /></p>
<p>可以看到拟合结果非常烂！因为一开始计算tps时用了平方（二次项），但是使用logistic估计ps时并没有用平方。</p>
<p>我们把公式也变成平方即可，此时再画一个拟合图就完美一致了！如下所示：</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="1035-psm.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 对x.Age平方</span></span>
<span id="cb566-2"><a href="1035-psm.html#cb566-2" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span><span class="fu">I</span>(x.Age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>x.Age <span class="sc">+</span>x.Gender,</span>
<span id="cb566-3"><a href="1035-psm.html#cb566-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>data.complete) </span>
<span id="cb566-4"><a href="1035-psm.html#cb566-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb566-5"><a href="1035-psm.html#cb566-5" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> m.out<span class="sc">$</span>distance</span>
<span id="cb566-6"><a href="1035-psm.html#cb566-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb566-7"><a href="1035-psm.html#cb566-7" aria-hidden="true" tabindex="-1"></a>tps.comp <span class="ot">&lt;-</span> tps[<span class="fu">complete.cases</span>(data)]</span>
<span id="cb566-8"><a href="1035-psm.html#cb566-8" aria-hidden="true" tabindex="-1"></a>Smoke.comp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Smoke[<span class="fu">complete.cases</span>(data)])</span>
<span id="cb566-9"><a href="1035-psm.html#cb566-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">True=</span>tps.comp, <span class="at">Estimated=</span>eps, <span class="at">Smoke=</span>Smoke.comp)</span>
<span id="cb566-10"><a href="1035-psm.html#cb566-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>True, <span class="at">y=</span>Estimated, <span class="at">colour=</span>Smoke)) <span class="sc">+</span></span>
<span id="cb566-11"><a href="1035-psm.html#cb566-11" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb566-12"><a href="1035-psm.html#cb566-12" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb566-13"><a href="1035-psm.html#cb566-13" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_limits</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="1035-psm_files/figure-html/unnamed-chunk-7-1.png" width="90%" /></p>
<p>此时的PS是通过logistic回归计算的，既然PS就是P值，当然你完全可以用<code>glm</code>自己计算，通过以下方法：</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="1035-psm.html#cb567-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">glm</span>(Smoke<span class="sc">~</span><span class="fu">I</span>(x.Age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>x.Age <span class="sc">+</span>x.Gender, <span class="at">data=</span>data.complete,</span>
<span id="cb567-2"><a href="1035-psm.html#cb567-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb567-3"><a href="1035-psm.html#cb567-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-4"><a href="1035-psm.html#cb567-4" aria-hidden="true" tabindex="-1"></a>tmp.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">estimated =</span> tmp<span class="sc">$</span>fitted.values,</span>
<span id="cb567-5"><a href="1035-psm.html#cb567-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">true =</span> tps.comp,</span>
<span id="cb567-6"><a href="1035-psm.html#cb567-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Smoke=</span>Smoke.comp)</span>
<span id="cb567-7"><a href="1035-psm.html#cb567-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-8"><a href="1035-psm.html#cb567-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tmp.df, <span class="fu">aes</span>(true, estimated))<span class="sc">+</span></span>
<span id="cb567-9"><a href="1035-psm.html#cb567-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Smoke))<span class="sc">+</span></span>
<span id="cb567-10"><a href="1035-psm.html#cb567-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb567-11"><a href="1035-psm.html#cb567-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="1035-psm_files/figure-html/unnamed-chunk-8-1.png" width="90%" /></p>
<p>看这个结果和<code>matchit</code>得到的结果完全一样！</p>
<p>改变<code>matchit()</code>的参数即可使用不同的算法估计PS，比如下面是分类和回归树及神经网络方法：</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="1035-psm.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cart</span></span>
<span id="cb568-2"><a href="1035-psm.html#cb568-2" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb568-3"><a href="1035-psm.html#cb568-3" aria-hidden="true" tabindex="-1"></a><span class="at">data=</span>data.complete,</span>
<span id="cb568-4"><a href="1035-psm.html#cb568-4" aria-hidden="true" tabindex="-1"></a><span class="at">distance=</span><span class="st">&#39;rpart&#39;</span>)</span>
<span id="cb568-5"><a href="1035-psm.html#cb568-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb568-6"><a href="1035-psm.html#cb568-6" aria-hidden="true" tabindex="-1"></a><span class="co"># nnet</span></span>
<span id="cb568-7"><a href="1035-psm.html#cb568-7" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb568-8"><a href="1035-psm.html#cb568-8" aria-hidden="true" tabindex="-1"></a><span class="at">data=</span>data.complete,</span>
<span id="cb568-9"><a href="1035-psm.html#cb568-9" aria-hidden="true" tabindex="-1"></a><span class="at">distance=</span><span class="st">&#39;nnet&#39;</span>,</span>
<span id="cb568-10"><a href="1035-psm.html#cb568-10" aria-hidden="true" tabindex="-1"></a><span class="at">distance.options=</span><span class="fu">list</span>(<span class="at">size=</span><span class="dv">16</span>))</span></code></pre></div>
<p>默认的只有4种方法，但是完全可以自己通过其他方法计算PS，然后提供给<code>distance</code>参数即可！非常强大！</p>
<div id="使用随机森林计算ps" class="section level3 hasAnchor" number="35.2.1">
<h3><span class="header-section-number">35.2.1</span> 使用随机森林计算PS<a href="1035-psm.html#使用随机森林计算ps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>默认没提供随机森林的算法，我们可以通过其他R包计算，反正PS就是P值，只要拿到P值就可以了！</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="1035-psm.html#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用随机森林构建模型</span></span>
<span id="cb569-2"><a href="1035-psm.html#cb569-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb569-3"><a href="1035-psm.html#cb569-3" aria-hidden="true" tabindex="-1"></a><span class="do">## randomForest 4.7-1.1</span></span>
<span id="cb569-4"><a href="1035-psm.html#cb569-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Type rfNews() to see new features/changes/bug fixes.</span></span>
<span id="cb569-5"><a href="1035-psm.html#cb569-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb569-6"><a href="1035-psm.html#cb569-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Attaching package: &#39;randomForest&#39;</span></span>
<span id="cb569-7"><a href="1035-psm.html#cb569-7" aria-hidden="true" tabindex="-1"></a><span class="do">## The following object is masked from &#39;package:ggplot2&#39;:</span></span>
<span id="cb569-8"><a href="1035-psm.html#cb569-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb569-9"><a href="1035-psm.html#cb569-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     margin</span></span>
<span id="cb569-10"><a href="1035-psm.html#cb569-10" aria-hidden="true" tabindex="-1"></a>data.complete<span class="sc">$</span>Smoke <span class="ot">&lt;-</span> <span class="fu">factor</span>(data.complete<span class="sc">$</span>Smoke)</span>
<span id="cb569-11"><a href="1035-psm.html#cb569-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-12"><a href="1035-psm.html#cb569-12" aria-hidden="true" tabindex="-1"></a>rf.out <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Smoke<span class="sc">~</span>x.Age<span class="sc">+</span>x.Gender, <span class="at">data=</span>data.complete)</span>
<span id="cb569-13"><a href="1035-psm.html#cb569-13" aria-hidden="true" tabindex="-1"></a>rf.out</span>
<span id="cb569-14"><a href="1035-psm.html#cb569-14" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb569-15"><a href="1035-psm.html#cb569-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb569-16"><a href="1035-psm.html#cb569-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  randomForest(formula = Smoke ~ x.Age + x.Gender, data = data.complete) </span></span>
<span id="cb569-17"><a href="1035-psm.html#cb569-17" aria-hidden="true" tabindex="-1"></a><span class="do">##                Type of random forest: classification</span></span>
<span id="cb569-18"><a href="1035-psm.html#cb569-18" aria-hidden="true" tabindex="-1"></a><span class="do">##                      Number of trees: 500</span></span>
<span id="cb569-19"><a href="1035-psm.html#cb569-19" aria-hidden="true" tabindex="-1"></a><span class="do">## No. of variables tried at each split: 1</span></span>
<span id="cb569-20"><a href="1035-psm.html#cb569-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb569-21"><a href="1035-psm.html#cb569-21" aria-hidden="true" tabindex="-1"></a><span class="do">##         OOB estimate of  error rate: 22.5%</span></span>
<span id="cb569-22"><a href="1035-psm.html#cb569-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Confusion matrix:</span></span>
<span id="cb569-23"><a href="1035-psm.html#cb569-23" aria-hidden="true" tabindex="-1"></a><span class="do">##     0   1 class.error</span></span>
<span id="cb569-24"><a href="1035-psm.html#cb569-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 0 360 102   0.2207792</span></span>
<span id="cb569-25"><a href="1035-psm.html#cb569-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  85 284   0.2303523</span></span></code></pre></div>
<p>从随机森林结果中提取预测类别为1（有CVD）的概率：</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="1035-psm.html#cb570-1" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> rf.out<span class="sc">$</span>votes[,<span class="dv">2</span>] <span class="co"># Estimated PS</span></span></code></pre></div>
<p>接下来只要把这个eps提供给<code>distance</code>参数即可：</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="1035-psm.html#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matchit</span>(<span class="at">formula=</span>Smoke<span class="sc">~</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb571-2"><a href="1035-psm.html#cb571-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">data=</span>data.complete,</span>
<span id="cb571-3"><a href="1035-psm.html#cb571-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">distance=</span>eps, <span class="co"># 自己估计的eps</span></span>
<span id="cb571-4"><a href="1035-psm.html#cb571-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method=</span><span class="st">&#39;nearest&#39;</span>,</span>
<span id="cb571-5"><a href="1035-psm.html#cb571-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">replace=</span><span class="cn">TRUE</span>,</span>
<span id="cb571-6"><a href="1035-psm.html#cb571-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">discard=</span><span class="st">&#39;both&#39;</span>,</span>
<span id="cb571-7"><a href="1035-psm.html#cb571-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ratio=</span><span class="dv">2</span>)</span>
<span id="cb571-8"><a href="1035-psm.html#cb571-8" aria-hidden="true" tabindex="-1"></a><span class="do">## A matchit object</span></span>
<span id="cb571-9"><a href="1035-psm.html#cb571-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  - method: 2:1 nearest neighbor matching with replacement</span></span>
<span id="cb571-10"><a href="1035-psm.html#cb571-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  - distance: User-defined [common support]</span></span>
<span id="cb571-11"><a href="1035-psm.html#cb571-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  - common support: units from both groups dropped</span></span>
<span id="cb571-12"><a href="1035-psm.html#cb571-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  - number of obs.: 831 (original), 520 (matched)</span></span>
<span id="cb571-13"><a href="1035-psm.html#cb571-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  - target estimand: ATT</span></span>
<span id="cb571-14"><a href="1035-psm.html#cb571-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  - covariates: x.Age, x.Gender</span></span></code></pre></div>
<p>其他方法也是同理，只需要提供P值即可，但并不是越复杂的方法效果越好哦！不信的话可以把几种方法得到的eps都画一个散点拟合图看看效果，这个数据是逻辑回归最好哈！</p>
</div>
</div>
<div id="主要匹配方法选择" class="section level2 hasAnchor" number="35.3">
<h2><span class="header-section-number">35.3</span> 主要匹配方法选择<a href="1035-psm.html#主要匹配方法选择" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>在确定了使用哪种算法计算PS后，匹配方法也是需要注意的一个问题，需要注意以下几个方面，首先是匹配方法的选择（method），然后是采样手段（有无放回），相似度的度量（卡钳值或其他），匹配比例（1:1或1：多）。</p>
<ul>
<li><code>method</code>:
<ul>
<li>默认的匹配方法是最近邻匹配nearest，其他方法还有</li>
<li>“exact” (exact matching),</li>
<li>“full” (optimal full matching),</li>
<li>“optimal” (optimal pair matching),</li>
<li>“cardinality”(cardinality and template matching),</li>
<li>“subclass” (subclassification),</li>
<li>“genetic” (genetic matching),</li>
<li>“cem” (coarsened exact matching)</li>
</ul></li>
</ul>
<p>每个匹配方法都提供了详细的解释，大家感兴趣的自己查看即可。</p>
<ul>
<li><p><code>caliper</code>:卡钳值，也就是配对标准，两组的概率值（PS）差距在这个标准内才会配对。这里的卡钳值是PS标准差的倍数，默认是不设置卡钳值。还有一个<code>std.caliper</code>参数，默认是TRUE，如果设置FALSE，你设置的卡钳值就直接是PS的倍数。</p></li>
<li><p><code>replace</code>:能否重复匹配，默认是FALSE，意思是假如干预组的1号匹配到了对照组的A，那A就不能再和其他的干预组进行匹配了。</p></li>
<li><p><code>ratio</code>:设置匹配比例，干预组:对照组到底是1比几，默认为1:1。ratio=2即是干预组：对照组是1:2。所以一般要求数据的对照组数量多于干预组才行。如果对照组比干预组多出很多，完全可以设置1:n进行匹配，这样还能损失更少的样本信息，但是一般也不会超过1:4。</p></li>
<li><p><code>reestimate</code>:如果是TRUE，丢掉没匹配上的样本，PS会使用剩下的样本重新计算PS，如果是FALSE或者不写就不会重新计算PS。</p></li>
</ul>
<p><img src="figs/Snipaste_2023-04-05_17-00-16.png" width="90%" /></p>
<p><img src="figs/Snipaste_2023-04-05_17-00-55.png" width="90%" /></p>
<p><img src="figs/Snipaste_2023-04-05_17-01-28.png" width="90%" /></p>
<p>比如下面是一个<strong>有放回的，1:2的，最近邻匹配</strong>：</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="1035-psm.html#cb572-1" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb572-2"><a href="1035-psm.html#cb572-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>data.complete,</span>
<span id="cb572-3"><a href="1035-psm.html#cb572-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance=</span><span class="st">&#39;logit&#39;</span>,</span>
<span id="cb572-4"><a href="1035-psm.html#cb572-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method=</span><span class="st">&#39;nearest&#39;</span>,</span>
<span id="cb572-5"><a href="1035-psm.html#cb572-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replace=</span><span class="cn">TRUE</span>,</span>
<span id="cb572-6"><a href="1035-psm.html#cb572-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ratio=</span><span class="dv">2</span>)</span></code></pre></div>
<p>可以通过<code>m.out$match.matrix</code>获取配好的对子：</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="1035-psm.html#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(m.out<span class="sc">$</span>match.matrix)</span>
<span id="cb573-2"><a href="1035-psm.html#cb573-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    [,1]  [,2] </span></span>
<span id="cb573-3"><a href="1035-psm.html#cb573-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  &quot;204&quot; &quot;23&quot; </span></span>
<span id="cb573-4"><a href="1035-psm.html#cb573-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  &quot;283&quot; &quot;163&quot;</span></span>
<span id="cb573-5"><a href="1035-psm.html#cb573-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 &quot;56&quot;  &quot;30&quot; </span></span>
<span id="cb573-6"><a href="1035-psm.html#cb573-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 &quot;41&quot;  &quot;28&quot; </span></span>
<span id="cb573-7"><a href="1035-psm.html#cb573-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 20 &quot;79&quot;  &quot;38&quot; </span></span>
<span id="cb573-8"><a href="1035-psm.html#cb573-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 26 &quot;84&quot;  &quot;70&quot;</span></span></code></pre></div>
<p>第一列是干预组的序号，第二列是和干预组配好对的，对照组的序号。</p>
<p><code>m.out$discarded</code>查看某个样本是否被丢弃：</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="1035-psm.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(m.out<span class="sc">$</span>discarded)</span>
<span id="cb574-2"><a href="1035-psm.html#cb574-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb574-3"><a href="1035-psm.html#cb574-3" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE </span></span>
<span id="cb574-4"><a href="1035-psm.html#cb574-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   831</span></span></code></pre></div>
</div>
<div id="匹配后数据的平衡性检验" class="section level2 hasAnchor" number="35.4">
<h2><span class="header-section-number">35.4</span> 匹配后数据的平衡性检验<a href="1035-psm.html#匹配后数据的平衡性检验" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>检查匹配后的数据，主要是看协变量在不同组间是否已经均衡了（是不是没有差异了）。</p>
<p>关于这个倾向性评分匹配后数据的平衡性检验，文献中比较推荐使用<code>SMD</code>和<code>VR(variance ratio)</code>，SMD&lt;0.25说明均衡了，VR&gt;2.0或者VR&lt;0.5说明很不均衡（越接近1越均衡）！</p>
<p>但其实也可以用假设检验，比如t检验、卡方检验等，也是没有统一的标准！</p>
<p>做一个1:1无放回的最近邻匹配：</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="1035-psm.html#cb575-1" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb575-2"><a href="1035-psm.html#cb575-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>data.complete,</span>
<span id="cb575-3"><a href="1035-psm.html#cb575-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance=</span><span class="st">&#39;logit&#39;</span>,</span>
<span id="cb575-4"><a href="1035-psm.html#cb575-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method=</span><span class="st">&#39;nearest&#39;</span>,</span>
<span id="cb575-5"><a href="1035-psm.html#cb575-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replace=</span><span class="cn">FALSE</span>,</span>
<span id="cb575-6"><a href="1035-psm.html#cb575-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>通过<code>summary()</code>查看匹配前后，不同组间协变量的各种统计量。通常建议选择<code>standardize = TRUE</code>查看标准后的各协变量的平衡性指标：</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="1035-psm.html#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.out,<span class="at">standardize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb576-2"><a href="1035-psm.html#cb576-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb576-3"><a href="1035-psm.html#cb576-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb576-4"><a href="1035-psm.html#cb576-4" aria-hidden="true" tabindex="-1"></a><span class="do">## matchit(formula = Smoke ~ x.Age + x.Gender, data = data.complete, </span></span>
<span id="cb576-5"><a href="1035-psm.html#cb576-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     method = &quot;nearest&quot;, distance = &quot;logit&quot;, replace = FALSE, </span></span>
<span id="cb576-6"><a href="1035-psm.html#cb576-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     ratio = 1)</span></span>
<span id="cb576-7"><a href="1035-psm.html#cb576-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb576-8"><a href="1035-psm.html#cb576-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Summary of Balance for All Data:</span></span>
<span id="cb576-9"><a href="1035-psm.html#cb576-9" aria-hidden="true" tabindex="-1"></a><span class="do">##          Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span></span>
<span id="cb576-10"><a href="1035-psm.html#cb576-10" aria-hidden="true" tabindex="-1"></a><span class="do">## distance        0.5170        0.3858          0.9050     0.6205    0.2069</span></span>
<span id="cb576-11"><a href="1035-psm.html#cb576-11" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Age          47.0352       42.7619          0.5247     0.1711    0.1306</span></span>
<span id="cb576-12"><a href="1035-psm.html#cb576-12" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Gender        0.7832        0.4502          0.8081          .    0.3330</span></span>
<span id="cb576-13"><a href="1035-psm.html#cb576-13" aria-hidden="true" tabindex="-1"></a><span class="do">##          eCDF Max</span></span>
<span id="cb576-14"><a href="1035-psm.html#cb576-14" aria-hidden="true" tabindex="-1"></a><span class="do">## distance   0.4833</span></span>
<span id="cb576-15"><a href="1035-psm.html#cb576-15" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Age      0.3629</span></span>
<span id="cb576-16"><a href="1035-psm.html#cb576-16" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Gender   0.3330</span></span>
<span id="cb576-17"><a href="1035-psm.html#cb576-17" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb576-18"><a href="1035-psm.html#cb576-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Summary of Balance for Matched Data:</span></span>
<span id="cb576-19"><a href="1035-psm.html#cb576-19" aria-hidden="true" tabindex="-1"></a><span class="do">##          Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span></span>
<span id="cb576-20"><a href="1035-psm.html#cb576-20" aria-hidden="true" tabindex="-1"></a><span class="do">## distance        0.5170        0.4380          0.5448     0.7605    0.1298</span></span>
<span id="cb576-21"><a href="1035-psm.html#cb576-21" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Age          47.0352       47.3035         -0.0329     0.1908    0.1072</span></span>
<span id="cb576-22"><a href="1035-psm.html#cb576-22" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Gender        0.7832        0.5610          0.5393          .    0.2222</span></span>
<span id="cb576-23"><a href="1035-psm.html#cb576-23" aria-hidden="true" tabindex="-1"></a><span class="do">##          eCDF Max Std. Pair Dist.</span></span>
<span id="cb576-24"><a href="1035-psm.html#cb576-24" aria-hidden="true" tabindex="-1"></a><span class="do">## distance   0.4255          0.7108</span></span>
<span id="cb576-25"><a href="1035-psm.html#cb576-25" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Age      0.2439          2.2436</span></span>
<span id="cb576-26"><a href="1035-psm.html#cb576-26" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Gender   0.2222          0.5393</span></span>
<span id="cb576-27"><a href="1035-psm.html#cb576-27" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb576-28"><a href="1035-psm.html#cb576-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Sample Sizes:</span></span>
<span id="cb576-29"><a href="1035-psm.html#cb576-29" aria-hidden="true" tabindex="-1"></a><span class="do">##           Control Treated</span></span>
<span id="cb576-30"><a href="1035-psm.html#cb576-30" aria-hidden="true" tabindex="-1"></a><span class="do">## All           462     369</span></span>
<span id="cb576-31"><a href="1035-psm.html#cb576-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Matched       369     369</span></span>
<span id="cb576-32"><a href="1035-psm.html#cb576-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Unmatched      93       0</span></span>
<span id="cb576-33"><a href="1035-psm.html#cb576-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Discarded       0       0</span></span></code></pre></div>
<p>结果主要是3个部分：</p>
<ul>
<li><code>Summary of Balance for All Data</code>：原始数据中干预组和对照组的平均PS值和平均协变量，SMD,VR，每个协变量和PS的CDF（cumulative distribution functions）的均值和最大值</li>
<li><code>Summary of Balance for Matched Data</code>：匹配后数据的指标</li>
<li><code>Sample Sizes</code>：样本数量</li>
</ul>
<p>通过观察比较匹配前后的数据指标可知，<code>x.Age</code>均衡了（0.0329&lt;0.1），但是<code>x.Gender</code>并没有均衡(0.5393&gt;0.1)！</p>
<p>这个默认的函数在计算SMD的时候会把分类变量按照连续性变量进行计算，所以计算结果是有一些问题的。在一开始计算匹配前数据的SMD时我们用的是<code>tableone</code>这个包，匹配后数据的SMD理论上也是可以用这个包的：</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="1035-psm.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 首先提取匹配后的数据</span></span>
<span id="cb577-2"><a href="1035-psm.html#cb577-2" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m.out)</span>
<span id="cb577-3"><a href="1035-psm.html#cb577-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-4"><a href="1035-psm.html#cb577-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tableone)</span>
<span id="cb577-5"><a href="1035-psm.html#cb577-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-6"><a href="1035-psm.html#cb577-6" aria-hidden="true" tabindex="-1"></a>table5 <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&#39;x.Age&#39;</span>, <span class="st">&#39;x.Gender&#39;</span>, <span class="st">&#39;CVD&#39;</span>),</span>
<span id="cb577-7"><a href="1035-psm.html#cb577-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> mdata,</span>
<span id="cb577-8"><a href="1035-psm.html#cb577-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">factorVars =</span> <span class="fu">c</span>(<span class="st">&#39;x.Gender&#39;</span>, <span class="st">&#39;CVD&#39;</span>),</span>
<span id="cb577-9"><a href="1035-psm.html#cb577-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">strata =</span> <span class="st">&#39;Smoke&#39;</span>,</span>
<span id="cb577-10"><a href="1035-psm.html#cb577-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">smd=</span><span class="cn">TRUE</span>)</span>
<span id="cb577-11"><a href="1035-psm.html#cb577-11" aria-hidden="true" tabindex="-1"></a>table5 <span class="ot">&lt;-</span> <span class="fu">print</span>(table5, <span class="at">smd=</span><span class="cn">TRUE</span>, <span class="at">showAllLevels =</span> <span class="cn">TRUE</span>, </span>
<span id="cb577-12"><a href="1035-psm.html#cb577-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">noSpaces =</span> <span class="cn">TRUE</span>, <span class="at">printToggle =</span> <span class="cn">FALSE</span>)</span>
<span id="cb577-13"><a href="1035-psm.html#cb577-13" aria-hidden="true" tabindex="-1"></a>table5</span>
<span id="cb577-14"><a href="1035-psm.html#cb577-14" aria-hidden="true" tabindex="-1"></a><span class="do">##                    Stratified by Smoke</span></span>
<span id="cb577-15"><a href="1035-psm.html#cb577-15" aria-hidden="true" tabindex="-1"></a><span class="do">##                     level 0               1              p        test SMD    </span></span>
<span id="cb577-16"><a href="1035-psm.html#cb577-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   n                 &quot;&quot;    &quot;369&quot;           &quot;369&quot;          &quot;&quot;       &quot;&quot;   &quot;&quot;     </span></span>
<span id="cb577-17"><a href="1035-psm.html#cb577-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   x.Age (mean (SD)) &quot;&quot;    &quot;47.30 (18.65)&quot; &quot;47.04 (8.14)&quot; &quot;0.800&quot;  &quot;&quot;   &quot;0.019&quot;</span></span>
<span id="cb577-18"><a href="1035-psm.html#cb577-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   x.Gender (%)      &quot;0&quot;   &quot;162 (43.9)&quot;    &quot;80 (21.7)&quot;    &quot;&lt;0.001&quot; &quot;&quot;   &quot;0.487&quot;</span></span>
<span id="cb577-19"><a href="1035-psm.html#cb577-19" aria-hidden="true" tabindex="-1"></a><span class="do">##                     &quot;1&quot;   &quot;207 (56.1)&quot;    &quot;289 (78.3)&quot;   &quot;&quot;       &quot;&quot;   &quot;&quot;     </span></span>
<span id="cb577-20"><a href="1035-psm.html#cb577-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   CVD (%)           &quot;0&quot;   &quot;287 (77.8)&quot;    &quot;190 (51.5)&quot;   &quot;&lt;0.001&quot; &quot;&quot;   &quot;0.572&quot;</span></span>
<span id="cb577-21"><a href="1035-psm.html#cb577-21" aria-hidden="true" tabindex="-1"></a><span class="do">##                     &quot;1&quot;   &quot;82 (22.2)&quot;     &quot;179 (48.5)&quot;   &quot;&quot;       &quot;&quot;   &quot;&quot;</span></span></code></pre></div>
<p>这个<code>tableone</code>计算的<code>x.Gender</code>的SMD是0.487，也是表明这个变量并没有被均衡。</p>
<p>但是<code>tableone</code>这个包计算的SMD也是有一些问题的，具体原因大家自己读文献吧：Zhang Z, Kim HJ, Lonjon G, et al. Balance diagnostics after propensity score matching. Ann Transl Med 2019;7:16.</p>
<p>所以推荐大家使用<code>cobalt</code>包进行平衡性指标的计算。</p>
<div id="cobalt包" class="section level3 hasAnchor" number="35.4.1">
<h3><span class="header-section-number">35.4.1</span> cobalt包<a href="1035-psm.html#cobalt包" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>使用<code>cobalt</code>包进行平衡性指标的计算，这个包很专业，专门处理这类匹配问题的，大家可以去它的官网学习更多的细节！</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="1035-psm.html#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb578-2"><a href="1035-psm.html#cb578-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  cobalt (Version 4.4.1, Build Date: 2022-11-03)</span></span>
<span id="cb578-3"><a href="1035-psm.html#cb578-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb578-4"><a href="1035-psm.html#cb578-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Attaching package: &#39;cobalt&#39;</span></span>
<span id="cb578-5"><a href="1035-psm.html#cb578-5" aria-hidden="true" tabindex="-1"></a><span class="do">## The following object is masked from &#39;package:MatchIt&#39;:</span></span>
<span id="cb578-6"><a href="1035-psm.html#cb578-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb578-7"><a href="1035-psm.html#cb578-7" aria-hidden="true" tabindex="-1"></a><span class="do">##     lalonde</span></span>
<span id="cb578-8"><a href="1035-psm.html#cb578-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb578-9"><a href="1035-psm.html#cb578-9" aria-hidden="true" tabindex="-1"></a><span class="co"># m.threshold表示SMD的阈值，小于这个阈值的协变量是平衡的</span></span>
<span id="cb578-10"><a href="1035-psm.html#cb578-10" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(m.out, <span class="at">m.threshold =</span> <span class="fl">0.1</span>, <span class="at">un =</span> <span class="cn">TRUE</span>)</span>
<span id="cb578-11"><a href="1035-psm.html#cb578-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Balance Measures</span></span>
<span id="cb578-12"><a href="1035-psm.html#cb578-12" aria-hidden="true" tabindex="-1"></a><span class="do">##              Type Diff.Un Diff.Adj        M.Threshold</span></span>
<span id="cb578-13"><a href="1035-psm.html#cb578-13" aria-hidden="true" tabindex="-1"></a><span class="do">## distance Distance  0.9050   0.5448                   </span></span>
<span id="cb578-14"><a href="1035-psm.html#cb578-14" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Age     Contin.  0.5247  -0.0329     Balanced, &lt;0.1</span></span>
<span id="cb578-15"><a href="1035-psm.html#cb578-15" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Gender   Binary  0.3330   0.2222 Not Balanced, &gt;0.1</span></span>
<span id="cb578-16"><a href="1035-psm.html#cb578-16" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb578-17"><a href="1035-psm.html#cb578-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Balance tally for mean differences</span></span>
<span id="cb578-18"><a href="1035-psm.html#cb578-18" aria-hidden="true" tabindex="-1"></a><span class="do">##                    count</span></span>
<span id="cb578-19"><a href="1035-psm.html#cb578-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Balanced, &lt;0.1         1</span></span>
<span id="cb578-20"><a href="1035-psm.html#cb578-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Not Balanced, &gt;0.1     1</span></span>
<span id="cb578-21"><a href="1035-psm.html#cb578-21" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb578-22"><a href="1035-psm.html#cb578-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Variable with the greatest mean difference</span></span>
<span id="cb578-23"><a href="1035-psm.html#cb578-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  Variable Diff.Adj        M.Threshold</span></span>
<span id="cb578-24"><a href="1035-psm.html#cb578-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  x.Gender   0.2222 Not Balanced, &gt;0.1</span></span>
<span id="cb578-25"><a href="1035-psm.html#cb578-25" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb578-26"><a href="1035-psm.html#cb578-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Sample sizes</span></span>
<span id="cb578-27"><a href="1035-psm.html#cb578-27" aria-hidden="true" tabindex="-1"></a><span class="do">##           Control Treated</span></span>
<span id="cb578-28"><a href="1035-psm.html#cb578-28" aria-hidden="true" tabindex="-1"></a><span class="do">## All           462     369</span></span>
<span id="cb578-29"><a href="1035-psm.html#cb578-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Matched       369     369</span></span>
<span id="cb578-30"><a href="1035-psm.html#cb578-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Unmatched      93       0</span></span></code></pre></div>
<p><code>x.Age</code>的SMD和默认是一样的，但是<code>x.Gender</code>是0.2222，比默认的小多了！</p>
<p>这个结果比默认的结果更可靠，具体原因大家自己去读上面那篇文献。</p>
<p>计算VR，结果中并没有计算<code>x.Gender</code>的VR，而且根据VR来看，<code>x.Age</code>也没有均衡。</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="1035-psm.html#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(m.out, <span class="at">v.threshold =</span> <span class="dv">2</span>)</span>
<span id="cb579-2"><a href="1035-psm.html#cb579-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Balance Measures</span></span>
<span id="cb579-3"><a href="1035-psm.html#cb579-3" aria-hidden="true" tabindex="-1"></a><span class="do">##              Type Diff.Adj V.Ratio.Adj      V.Threshold</span></span>
<span id="cb579-4"><a href="1035-psm.html#cb579-4" aria-hidden="true" tabindex="-1"></a><span class="do">## distance Distance   0.5448      0.7605     Balanced, &lt;2</span></span>
<span id="cb579-5"><a href="1035-psm.html#cb579-5" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Age     Contin.  -0.0329      0.1908 Not Balanced, &gt;2</span></span>
<span id="cb579-6"><a href="1035-psm.html#cb579-6" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Gender   Binary   0.2222           .                 </span></span>
<span id="cb579-7"><a href="1035-psm.html#cb579-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb579-8"><a href="1035-psm.html#cb579-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Balance tally for variance ratios</span></span>
<span id="cb579-9"><a href="1035-psm.html#cb579-9" aria-hidden="true" tabindex="-1"></a><span class="do">##                  count</span></span>
<span id="cb579-10"><a href="1035-psm.html#cb579-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Balanced, &lt;2         1</span></span>
<span id="cb579-11"><a href="1035-psm.html#cb579-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Not Balanced, &gt;2     1</span></span>
<span id="cb579-12"><a href="1035-psm.html#cb579-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb579-13"><a href="1035-psm.html#cb579-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Variable with the greatest variance ratio</span></span>
<span id="cb579-14"><a href="1035-psm.html#cb579-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  Variable V.Ratio.Adj      V.Threshold</span></span>
<span id="cb579-15"><a href="1035-psm.html#cb579-15" aria-hidden="true" tabindex="-1"></a><span class="do">##     x.Age      0.1908 Not Balanced, &gt;2</span></span>
<span id="cb579-16"><a href="1035-psm.html#cb579-16" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb579-17"><a href="1035-psm.html#cb579-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Sample sizes</span></span>
<span id="cb579-18"><a href="1035-psm.html#cb579-18" aria-hidden="true" tabindex="-1"></a><span class="do">##           Control Treated</span></span>
<span id="cb579-19"><a href="1035-psm.html#cb579-19" aria-hidden="true" tabindex="-1"></a><span class="do">## All           462     369</span></span>
<span id="cb579-20"><a href="1035-psm.html#cb579-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Matched       369     369</span></span>
<span id="cb579-21"><a href="1035-psm.html#cb579-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Unmatched      93       0</span></span></code></pre></div>
</div>
<div id="统计检验衡量均衡性" class="section level3 hasAnchor" number="35.4.2">
<h3><span class="header-section-number">35.4.2</span> 统计检验衡量均衡性<a href="1035-psm.html#统计检验衡量均衡性" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>除了SMD和VR之外，传统的统计检验也可以用于检查匹配后的数据有没有均衡！</p>
<p>首先取出匹配好的数据：</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="1035-psm.html#cb580-1" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m.out)</span>
<span id="cb580-2"><a href="1035-psm.html#cb580-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mdata)</span>
<span id="cb580-3"><a href="1035-psm.html#cb580-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    x.Age x.Gender Smoke CVD  distance weights subclass</span></span>
<span id="cb580-4"><a href="1035-psm.html#cb580-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1     51        0     1   0 0.2583040       1        1</span></span>
<span id="cb580-5"><a href="1035-psm.html#cb580-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2     50        0     0   0 0.2545807       1        2</span></span>
<span id="cb580-6"><a href="1035-psm.html#cb580-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 6     56        0     1   1 0.2774451       1      229</span></span>
<span id="cb580-7"><a href="1035-psm.html#cb580-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 9     71        0     0   1 0.3397803       1      142</span></span>
<span id="cb580-8"><a href="1035-psm.html#cb580-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 10    47        0     1   1 0.2436248       1      345</span></span>
<span id="cb580-9"><a href="1035-psm.html#cb580-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 12    59        0     1   1 0.2893402       1        2</span></span></code></pre></div>
<p>其中<code>distance</code>是估计的PS，<code>weights</code>是权重，因为我们用的是1:1无放回匹配，所以全都是1。</p>
<p>下面用t检验看看匹配后干预组和对照组的<code>x.Age</code>有没有差异：</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="1035-psm.html#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x.Age <span class="sc">~</span> Smoke, <span class="at">data =</span> mdata)</span>
<span id="cb581-2"><a href="1035-psm.html#cb581-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb581-3"><a href="1035-psm.html#cb581-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Welch Two Sample t-test</span></span>
<span id="cb581-4"><a href="1035-psm.html#cb581-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb581-5"><a href="1035-psm.html#cb581-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  x.Age by Smoke</span></span>
<span id="cb581-6"><a href="1035-psm.html#cb581-6" aria-hidden="true" tabindex="-1"></a><span class="do">## t = 0.25327, df = 503.47, p-value = 0.8002</span></span>
<span id="cb581-7"><a href="1035-psm.html#cb581-7" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb581-8"><a href="1035-psm.html#cb581-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 95 percent confidence interval:</span></span>
<span id="cb581-9"><a href="1035-psm.html#cb581-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  -1.812969  2.349555</span></span>
<span id="cb581-10"><a href="1035-psm.html#cb581-10" aria-hidden="true" tabindex="-1"></a><span class="do">## sample estimates:</span></span>
<span id="cb581-11"><a href="1035-psm.html#cb581-11" aria-hidden="true" tabindex="-1"></a><span class="do">## mean in group 0 mean in group 1 </span></span>
<span id="cb581-12"><a href="1035-psm.html#cb581-12" aria-hidden="true" tabindex="-1"></a><span class="do">##        47.30352        47.03523</span></span></code></pre></div>
<p>结果也是显示<code>x.Age</code>已经没有差异了！</p>
<p>然后用卡方检验看看<code>x.Gender</code>是否还有差异：</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="1035-psm.html#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(mdata<span class="sc">$</span>x.Gender, mdata<span class="sc">$</span>Smoke,<span class="at">correct =</span> F)</span>
<span id="cb582-2"><a href="1035-psm.html#cb582-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb582-3"><a href="1035-psm.html#cb582-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Pearson&#39;s Chi-squared test</span></span>
<span id="cb582-4"><a href="1035-psm.html#cb582-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb582-5"><a href="1035-psm.html#cb582-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  mdata$x.Gender and mdata$Smoke</span></span>
<span id="cb582-6"><a href="1035-psm.html#cb582-6" aria-hidden="true" tabindex="-1"></a><span class="do">## X-squared = 41.342, df = 1, p-value = 1.278e-10</span></span></code></pre></div>
<p>结果显示<code>x.Gender</code>还是有差异的，这个结果也和SMD的判断结果相同。</p>
</div>
</div>
<div id="结果可视化-1" class="section level2 hasAnchor" number="35.5">
<h2><span class="header-section-number">35.5</span> 结果可视化<a href="1035-psm.html#结果可视化-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>默认提供3种图形，但是美观性太差，就不放图了，大家感兴趣的可以自己试试看。</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="1035-psm.html#cb583-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.out) <span class="co"># 默认QQ图</span></span>
<span id="cb583-2"><a href="1035-psm.html#cb583-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.out, <span class="at">type =</span> <span class="st">&#39;jitter&#39;</span>) <span class="co"># 散点图</span></span>
<span id="cb583-3"><a href="1035-psm.html#cb583-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.out, <span class="at">type =</span> <span class="st">&#39;hist&#39;</span>) <span class="co"># 直方图</span></span></code></pre></div>
<p>默认的不好看，还是用<code>cobalt</code>包进行结果的可视化。</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="1035-psm.html#cb584-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb584-2"><a href="1035-psm.html#cb584-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bal.plot</span>(m.out, <span class="at">var.name =</span> <span class="st">&#39;x.Age&#39;</span>, <span class="at">which =</span> <span class="st">&#39;both&#39;</span>, <span class="at">grid=</span><span class="cn">TRUE</span>),</span>
<span id="cb584-3"><a href="1035-psm.html#cb584-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bal.plot</span>(m.out, <span class="at">var.name =</span> <span class="st">&#39;x.Gender&#39;</span>, <span class="at">which =</span> <span class="st">&#39;both&#39;</span>, <span class="at">grid=</span><span class="cn">TRUE</span>),</span>
<span id="cb584-4"><a href="1035-psm.html#cb584-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bal.plot</span>(m.out, <span class="at">var.name =</span> <span class="st">&#39;x.Age&#39;</span>, <span class="at">which =</span> <span class="st">&#39;both&#39;</span>, <span class="at">grid=</span><span class="cn">TRUE</span>, <span class="at">type=</span><span class="st">&quot;ecdf&quot;</span>),</span>
<span id="cb584-5"><a href="1035-psm.html#cb584-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 还有很多参数可调整</span></span>
<span id="cb584-6"><a href="1035-psm.html#cb584-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">love.plot</span>(<span class="fu">bal.tab</span>(m.out, <span class="at">m.threshold=</span><span class="fl">0.1</span>),</span>
<span id="cb584-7"><a href="1035-psm.html#cb584-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">stat =</span> <span class="st">&quot;mean.diffs&quot;</span>,</span>
<span id="cb584-8"><a href="1035-psm.html#cb584-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid=</span><span class="cn">TRUE</span>,</span>
<span id="cb584-9"><a href="1035-psm.html#cb584-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">stars=</span><span class="st">&quot;raw&quot;</span>,</span>
<span id="cb584-10"><a href="1035-psm.html#cb584-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">abs =</span> F)</span>
<span id="cb584-11"><a href="1035-psm.html#cb584-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="1035-psm_files/figure-html/unnamed-chunk-28-1.png" width="90%" /></p>
<p>上面两幅图展示的是协变量在匹配前（unadjusted sample）和匹配后（adjusted sample）的数据中的分布情况，连续型变量默认是画密度图，分类变量默认是画柱状图。</p>
<p>左下图是累计密度图。右下的<code>love plot</code>图可视化匹配前后协变量的SMD，两条竖线是0.1阈值线，匹配后<code>x.Age</code>在两条竖线之间，说明平衡，<code>x.Gender</code>不在两条竖线之间，说明还是没平衡。</p>
</div>
<div id="不平衡怎么办" class="section level2 hasAnchor" number="35.6">
<h2><span class="header-section-number">35.6</span> 不平衡怎么办？<a href="1035-psm.html#不平衡怎么办" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>比如这里的<code>x.Gender</code>这个变量就是不平衡的。</p>
<p>有非常多的方法可以尝试，这里提供5种方法，但是非常有可能你各种方法都试过了还是不平衡！</p>
<p>首先可以换一种计算PS的方法，可以换算法，换公式（增加二次项、交互项等）。</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="1035-psm.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 增加二次项，结果依然不平衡</span></span>
<span id="cb585-2"><a href="1035-psm.html#cb585-2" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span><span class="fu">I</span>(x.Age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb585-3"><a href="1035-psm.html#cb585-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>data.complete,</span>
<span id="cb585-4"><a href="1035-psm.html#cb585-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance=</span><span class="st">&#39;logit&#39;</span>,</span>
<span id="cb585-5"><a href="1035-psm.html#cb585-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method=</span><span class="st">&#39;nearest&#39;</span>,</span>
<span id="cb585-6"><a href="1035-psm.html#cb585-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replace=</span><span class="cn">FALSE</span>,</span>
<span id="cb585-7"><a href="1035-psm.html#cb585-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p>第二可以换匹配方法及对应的参数。</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="1035-psm.html#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 还是不平衡</span></span>
<span id="cb586-2"><a href="1035-psm.html#cb586-2" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span><span class="fu">I</span>(x.Age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb586-3"><a href="1035-psm.html#cb586-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>data.complete,</span>
<span id="cb586-4"><a href="1035-psm.html#cb586-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance=</span><span class="st">&#39;logit&#39;</span>,</span>
<span id="cb586-5"><a href="1035-psm.html#cb586-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method=</span><span class="st">&#39;genetic&#39;</span>,</span>
<span id="cb586-6"><a href="1035-psm.html#cb586-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pop.size=</span><span class="dv">100</span>)</span>
<span id="cb586-7"><a href="1035-psm.html#cb586-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(m.out, <span class="at">m.threshold=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p>第三，可以使用精确匹配，性别不平衡，那就在匹配时要求按照性别精确匹配，可以使用参数<code>exact=c('x.Gender')</code>。</p>
<p>但是这样做的代价是大部分样本都浪费了！只有一小部分才能匹配上！</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="1035-psm.html#cb587-1" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Smoke<span class="sc">~</span><span class="fu">I</span>(x.Age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>x.Age<span class="sc">+</span>x.Gender,</span>
<span id="cb587-2"><a href="1035-psm.html#cb587-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>data.complete,</span>
<span id="cb587-3"><a href="1035-psm.html#cb587-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance=</span><span class="st">&#39;logit&#39;</span>,</span>
<span id="cb587-4"><a href="1035-psm.html#cb587-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method=</span><span class="st">&#39;nearest&#39;</span>,</span>
<span id="cb587-5"><a href="1035-psm.html#cb587-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">exact =</span> <span class="fu">c</span>(<span class="st">&#39;x.Gender&#39;</span>,<span class="st">&#39;x.Age&#39;</span>), <span class="co"># 精准！</span></span>
<span id="cb587-6"><a href="1035-psm.html#cb587-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replace=</span><span class="cn">FALSE</span>,</span>
<span id="cb587-7"><a href="1035-psm.html#cb587-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ratio=</span><span class="dv">1</span>)</span>
<span id="cb587-8"><a href="1035-psm.html#cb587-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(m.out, <span class="at">m.threshold=</span><span class="fl">0.1</span>)</span>
<span id="cb587-9"><a href="1035-psm.html#cb587-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Balance Measures</span></span>
<span id="cb587-10"><a href="1035-psm.html#cb587-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                Type Diff.Adj    M.Threshold</span></span>
<span id="cb587-11"><a href="1035-psm.html#cb587-11" aria-hidden="true" tabindex="-1"></a><span class="do">## distance   Distance        0 Balanced, &lt;0.1</span></span>
<span id="cb587-12"><a href="1035-psm.html#cb587-12" aria-hidden="true" tabindex="-1"></a><span class="do">## I(x.Age^2)  Contin.        0 Balanced, &lt;0.1</span></span>
<span id="cb587-13"><a href="1035-psm.html#cb587-13" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Age       Contin.        0 Balanced, &lt;0.1</span></span>
<span id="cb587-14"><a href="1035-psm.html#cb587-14" aria-hidden="true" tabindex="-1"></a><span class="do">## x.Gender     Binary        0 Balanced, &lt;0.1</span></span>
<span id="cb587-15"><a href="1035-psm.html#cb587-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb587-16"><a href="1035-psm.html#cb587-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Balance tally for mean differences</span></span>
<span id="cb587-17"><a href="1035-psm.html#cb587-17" aria-hidden="true" tabindex="-1"></a><span class="do">##                    count</span></span>
<span id="cb587-18"><a href="1035-psm.html#cb587-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Balanced, &lt;0.1         4</span></span>
<span id="cb587-19"><a href="1035-psm.html#cb587-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Not Balanced, &gt;0.1     0</span></span>
<span id="cb587-20"><a href="1035-psm.html#cb587-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb587-21"><a href="1035-psm.html#cb587-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Variable with the greatest mean difference</span></span>
<span id="cb587-22"><a href="1035-psm.html#cb587-22" aria-hidden="true" tabindex="-1"></a><span class="do">##    Variable Diff.Adj    M.Threshold</span></span>
<span id="cb587-23"><a href="1035-psm.html#cb587-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  I(x.Age^2)        0 Balanced, &lt;0.1</span></span>
<span id="cb587-24"><a href="1035-psm.html#cb587-24" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb587-25"><a href="1035-psm.html#cb587-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Sample sizes</span></span>
<span id="cb587-26"><a href="1035-psm.html#cb587-26" aria-hidden="true" tabindex="-1"></a><span class="do">##           Control Treated</span></span>
<span id="cb587-27"><a href="1035-psm.html#cb587-27" aria-hidden="true" tabindex="-1"></a><span class="do">## All           462     369</span></span>
<span id="cb587-28"><a href="1035-psm.html#cb587-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Matched       147     147</span></span>
<span id="cb587-29"><a href="1035-psm.html#cb587-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Unmatched     315     222</span></span></code></pre></div>
<p>第四，增加样本量（一切误差问题都可以通过增加样本量解决）。</p>
<p>第五，匹配后结合其他方法，比如回归、分层等。</p>
</div>
<div id="其他问题" class="section level2 hasAnchor" number="35.7">
<h2><span class="header-section-number">35.7</span> 其他问题<a href="1035-psm.html#其他问题" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>这篇推文关于倾向性评分匹配说的还算详细，尤其是<code>matchIt</code>包的使用，但大部分都是基于开头说的那篇文献。</p>
<p>除此之外，关于倾向性评分，还有一些很重要的问题并没有涉及到。比如：</p>
<ul>
<li>样本权重不同，匹配后数据如何检查平衡性？</li>
<li>倾向性评分只能平衡记录到的协变量，对于潜在的、未被记录的误差不能平衡，怎么办？</li>
<li>处理因素多分组或者是连续型变量时如何处理？</li>
<li>倾向性评分的加权、回归、分层如何做？</li>
</ul>
<p>这些问题待以后有时间慢慢解决！</p>
</div>
<div id="参考资料-4" class="section level2 hasAnchor" number="35.8">
<h2><span class="header-section-number">35.8</span> 参考资料<a href="1035-psm.html#参考资料-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><a href="https://zhuanlan.zhihu.com/p/386501046" class="uri">https://zhuanlan.zhihu.com/p/386501046</a></li>
<li><a href="https://mp.weixin.qq.com/s/ITWBruRe5LhuPq8TXjxPZQ" class="uri">https://mp.weixin.qq.com/s/ITWBruRe5LhuPq8TXjxPZQ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/559469895" class="uri">https://zhuanlan.zhihu.com/p/559469895</a></li>
<li>Propensity score matching with R: conventional methods and new features</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="1034-finygray.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="1036-pssc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
